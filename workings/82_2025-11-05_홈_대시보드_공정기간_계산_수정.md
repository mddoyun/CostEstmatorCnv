# í™ˆ ëŒ€ì‹œë³´ë“œ ê³µì • ê¸°ê°„ ê³„ì‚° ìˆ˜ì •

**ë‚ ì§œ**: 2025-11-05
**ì‘ì—…ì**: Claude (AI Assistant)

## ê°œìš”

í™ˆ ëŒ€ì‹œë³´ë“œì˜ ê³µì • ê¸°ê°„ ê³„ì‚° ë¡œì§ì„ ê°„íŠ¸ ì°¨íŠ¸ íƒ­ê³¼ ì™„ì „íˆ ë™ì¼í•˜ê²Œ ìˆ˜ì •í–ˆìŠµë‹ˆë‹¤.

ê¸°ì¡´ì—ëŠ” ë°±ì—”ë“œ APIì—ì„œ `ActivityObject.start_date`/`end_date`ë¥¼ ì§ì ‘ ì¡°íšŒí–ˆìœ¼ë‚˜, ì´ í•„ë“œë“¤ì´ ë¹„ì–´ìˆì–´ ê³µì • ê¸°ê°„ì´ í‘œì‹œë˜ì§€ ì•ŠëŠ” ë¬¸ì œê°€ ìˆì—ˆìŠµë‹ˆë‹¤.

ê°„íŠ¸ ì°¨íŠ¸ íƒ­ì€ í”„ë¡ íŠ¸ì—”ë“œì—ì„œ `Activity.manual_start_date`ì™€ `ActivityObject.actual_duration`ì„ ê¸°ë°˜ìœ¼ë¡œ ë‚ ì§œë¥¼ ê³„ì‚°í•˜ë¯€ë¡œ, ëŒ€ì‹œë³´ë“œë„ ë™ì¼í•œ ë°©ì‹ì„ ì‚¬ìš©í•˜ë„ë¡ ë³€ê²½í–ˆìŠµë‹ˆë‹¤.

## ë¬¸ì œì 

### 1. ê³µì • ê¸°ê°„ì´ í‘œì‹œë˜ì§€ ì•ŠìŒ
- **ì¦ìƒ**: í”„ë¡œì íŠ¸ ì„ íƒ ì‹œ ëŒ€ì‹œë³´ë“œì— "ë°ì´í„° ì—†ìŒ" í‘œì‹œ
- **ì›ì¸**: `loadedActivityObjects`ê°€ ë¡œë“œë˜ì§€ ì•Šì€ ìƒíƒœì—ì„œ ê³„ì‚° ì‹œë„
- **ë¡œê·¸**:
  ```
  [Dashboard] No activity objects available
  [Dashboard] Updating dashboard UI with data:
    {schedule: {start_date_formatted: null, end_date_formatted: null, total_days: 0}}
  ```

### 2. ê°„íŠ¸ ì°¨íŠ¸ ë°©ë¬¸ í›„ì—ë§Œ í‘œì‹œë¨
- **ì¦ìƒ**: ê³µì •ê³„íš íƒ­ì„ í•œ ë²ˆ ë°©ë¬¸í•´ì•¼ ëŒ€ì‹œë³´ë“œì— ë‚ ì§œ í‘œì‹œ
- **ì›ì¸**: ê°„íŠ¸ ì°¨íŠ¸ íƒ­ì´ `loadedActivityObjects`ë¥¼ ë¡œë“œí•˜ê¸° ë•Œë¬¸
- **ë™ì‘**: ê³µì •ê³„íš â†’ í™ˆ ìˆœì„œë¡œ ì´ë™í•˜ë©´ ì •ìƒ í‘œì‹œ

### 3. ì¼ìˆ˜ ê³„ì‚° ë¶ˆì¼ì¹˜ (40ì¼ vs 41ì¼)
- **ì¦ìƒ**:
  - ê°„íŠ¸ ì°¨íŠ¸: `2025. 11. 5. ~ 2025. 12. 15. (40ì¼)`
  - ëŒ€ì‹œë³´ë“œ: `2025. 11. 5. ~ 2025. 12. 15. (41ì¼)`
- **ì›ì¸**:
  - ê°„íŠ¸ ì°¨íŠ¸: `Math.ceil((maxDate - minDate) / (1000 * 60 * 60 * 24))` (ë°€ë¦¬ì´ˆ ì°¨ì´ ê³„ì‚°)
  - ëŒ€ì‹œë³´ë“œ: `(end_date - start_date).days + 1` (ì¼ ë‹¨ìœ„ ì°¨ì´ + 1)

## í•´ê²° ë°©ë²•

### í•µì‹¬ ì ‘ê·¼

**"ê°„íŠ¸ ì°¨íŠ¸ì˜ 'í”„ë¡œì íŠ¸ ê¸°ê°„:' ë¡œì§ì„ ê·¸ëŒ€ë¡œ ì¬ì‚¬ìš©"**

ë°±ì—”ë“œ ê³„ì‚°ì„ ë²„ë¦¬ê³ , í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ê°„íŠ¸ ì°¨íŠ¸ì™€ ë™ì¼í•œ ë°©ì‹ìœ¼ë¡œ ê³„ì‚°í•˜ë„ë¡ ë³€ê²½í–ˆìŠµë‹ˆë‹¤.

### ìƒì„¸ ìˆ˜ì • ë‚´ì—­

#### 1. ActivityObjects ìë™ ë¡œë“œ ì¶”ê°€

**íŒŒì¼**: `connections/static/connections/home_tab_handlers.js`
**í•¨ìˆ˜**: `loadHomeDashboardData()` (lines 553-595)

**ë³€ê²½ ì‚¬í•­**:
```javascript
async function loadHomeDashboardData(projectId) {
    // â–¼â–¼â–¼ [ì¶”ê°€] ActivityObjects ë¨¼ì € ë¡œë“œ â–¼â–¼â–¼
    if (!window.loadedActivityObjects || window.loadedActivityObjects.length === 0) {
        console.log('[Dashboard] Loading activity objects first...');
        const aoResponse = await fetch(`/connections/api/activity-objects/${projectId}/`);
        const aoData = await aoResponse.json();
        if (aoData && Array.isArray(aoData)) {
            window.loadedActivityObjects = aoData;
            console.log('[Dashboard] Loaded', aoData.length, 'activity objects');
        }
    }
    // â–²â–²â–² [ì¶”ê°€] ì—¬ê¸°ê¹Œì§€ â–²â–²â–²

    // ë¹„ìš© ë°ì´í„°ëŠ” APIì—ì„œ
    const response = await fetch(`/connections/api/dashboard/${projectId}/`);
    const result = await response.json();

    if (result.success && result.data) {
        // ê³µì • ê¸°ê°„ì€ í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ê³„ì‚°
        const scheduleData = calculateScheduleDatesFromGantt();
        result.data.schedule = scheduleData;  // ë°±ì—”ë“œ ë°ì´í„° ë®ì–´ì“°ê¸°
        updateDashboardUI(result.data);
    }
}
```

**íš¨ê³¼**:
- í”„ë¡œì íŠ¸ ì„ íƒ ì‹œ ActivityObjectsë¥¼ ìë™ìœ¼ë¡œ APIì—ì„œ ê°€ì ¸ì˜´
- ê³µì •ê³„íš íƒ­ ë°©ë¬¸ ì—†ì´ ì¦‰ì‹œ ê³µì • ê¸°ê°„ í‘œì‹œ ê°€ëŠ¥

---

#### 2. ê°„íŠ¸ ì°¨íŠ¸ ê³„ì‚° ë¡œì§ ì¬ì‚¬ìš©

**íŒŒì¼**: `connections/static/connections/home_tab_handlers.js`
**í•¨ìˆ˜**: `calculateScheduleDatesFromGantt()` (lines 597-696)

**ì „ëµ**:
1. **Option 1**: `window.ganttMinDate`, `ganttMaxDate` ì „ì—­ ë³€ìˆ˜ ì‚¬ìš© (ê°„íŠ¸ ì°¨íŠ¸ ì´ë¯¸ ë Œë”ë§ëœ ê²½ìš°)
2. **Option 2**: `loadedActivityObjects`ì—ì„œ ì§ì ‘ ê³„ì‚° (ê°„íŠ¸ ì°¨íŠ¸ ë°©ë¬¸ ì „)

**êµ¬í˜„ ì½”ë“œ**:
```javascript
function calculateScheduleDatesFromGantt() {
    console.log('[Dashboard] Calculating schedule dates from gantt chart logic...');

    // ===== Option 1: ê°„íŠ¸ ì°¨íŠ¸ ì „ì—­ ë³€ìˆ˜ ì¬ì‚¬ìš© =====
    if (window.ganttMinDate && window.ganttMaxDate) {
        console.log('[Dashboard] Using existing gantt dates:', window.ganttMinDate, window.ganttMaxDate);

        // ê°„íŠ¸ ì°¨íŠ¸ì™€ ë™ì¼í•œ ê³„ì‚° ë°©ì‹
        const totalDays = Math.ceil((window.ganttMaxDate - window.ganttMinDate) / (1000 * 60 * 60 * 24));

        return {
            start_date_formatted: window.ganttMinDate.toLocaleDateString('ko-KR'),
            end_date_formatted: window.ganttMaxDate.toLocaleDateString('ko-KR'),
            total_days: totalDays
        };
    }

    // ===== Option 2: ActivityObjectsì—ì„œ ì§ì ‘ ê³„ì‚° =====
    if (!window.loadedActivityObjects || window.loadedActivityObjects.length === 0) {
        console.log('[Dashboard] No activity objects available');
        return { start_date_formatted: null, end_date_formatted: null, total_days: 0 };
    }

    console.log('[Dashboard] Calculating from activity objects:', window.loadedActivityObjects.length);

    // ActivityObject â†’ Activityë³„ duration í•©ì‚° (ê°„íŠ¸ ì°¨íŠ¸ì™€ ë™ì¼)
    const activityDurationMap = new Map();
    const activityMap = new Map();

    window.loadedActivityObjects.forEach(ao => {
        if (!ao.activity || !ao.actual_duration) return;

        const activityId = ao.activity.id;
        const duration = parseFloat(ao.actual_duration) || 0;

        if (!activityMap.has(activityId)) {
            activityMap.set(activityId, ao.activity);
        }

        const currentDuration = activityDurationMap.get(activityId) || 0;
        activityDurationMap.set(activityId, currentDuration + duration);
    });

    if (activityDurationMap.size === 0) {
        console.log('[Dashboard] No valid activity durations');
        return { start_date_formatted: null, end_date_formatted: null, total_days: 0 };
    }

    // ë‚ ì§œ ê³„ì‚° (ê°„íŠ¸ ì°¨íŠ¸ì™€ ë™ì¼)
    const projectStartDate = new Date(); // ì„ì‹œ: ì˜¤ëŠ˜ ë‚ ì§œ ê¸°ì¤€
    const allDates = [];

    activityDurationMap.forEach((totalDuration, activityId) => {
        const activity = activityMap.get(activityId);
        if (!activity) return;

        // manual_start_dateê°€ ìˆìœ¼ë©´ ì‚¬ìš©
        const startDate = activity.manual_start_date ?
            new Date(activity.manual_start_date) :
            new Date(projectStartDate);

        const endDate = new Date(startDate);
        endDate.setDate(endDate.getDate() + Math.ceil(totalDuration));

        allDates.push(startDate);
        allDates.push(endDate);
    });

    if (allDates.length === 0) {
        console.log('[Dashboard] No valid dates calculated');
        return { start_date_formatted: null, end_date_formatted: null, total_days: 0 };
    }

    const minDate = new Date(Math.min(...allDates));
    const maxDate = new Date(Math.max(...allDates));

    // âš ï¸ ì¤‘ìš”: ê°„íŠ¸ ì°¨íŠ¸ì™€ ë™ì¼í•œ ê³„ì‚° (Math.ceilë§Œ, +1 ì—†ìŒ)
    const totalDays = Math.ceil((maxDate - minDate) / (1000 * 60 * 60 * 24));

    console.log('[Dashboard] Calculated dates:', minDate, maxDate, totalDays);

    return {
        start_date_formatted: minDate.toLocaleDateString('ko-KR'),
        end_date_formatted: maxDate.toLocaleDateString('ko-KR'),
        total_days: totalDays
    };
}
```

**ì°¸ê³ **: ê°„íŠ¸ ì°¨íŠ¸ ë¡œì§ ìœ„ì¹˜
- `connections/static/connections/gantt_chart_handlers.js` lines 287-315: `buildGanttTasks()`
- `connections/static/connections/gantt_chart_handlers.js` lines 508-511: ë‚ ì§œ ë²”ìœ„ ê³„ì‚°

---

#### 3. ì¼ìˆ˜ ê³„ì‚° ë°©ì‹ í†µì¼

**ë³€ê²½ ì „**:
```javascript
// ëŒ€ì‹œë³´ë“œ (ì˜ëª»ëœ ë°©ì‹)
const totalDays = (end_date - start_date).days + 1;  // Python ìŠ¤íƒ€ì¼ ê³„ì‚° (ì‹¤íŒ¨)

// ë˜ëŠ”
const totalDays = Math.ceil((maxDate - minDate) / (1000 * 60 * 60 * 24)) + 1;  // +1 ì¶”ê°€ (41ì¼)
```

**ë³€ê²½ í›„**:
```javascript
// ê°„íŠ¸ ì°¨íŠ¸ì™€ ë™ì¼ (ì •ë‹µ)
const totalDays = Math.ceil((maxDate - minDate) / (1000 * 60 * 60 * 24));  // +1 ì—†ìŒ (40ì¼)
```

**ì ìš© ìœ„ì¹˜**:
- Line 609: `window.ganttMinDate`/`ganttMaxDate` ì‚¬ìš© ì‹œ
- Line 687: `loadedActivityObjects`ì—ì„œ ê³„ì‚° ì‹œ

**ê²°ê³¼**:
- ëŒ€ì‹œë³´ë“œ: `2025. 11. 5. ~ 2025. 12. 15. (40ì¼)`
- ê°„íŠ¸ ì°¨íŠ¸: `2025. 11. 5. ~ 2025. 12. 15. (40ì¼)` âœ… ì¼ì¹˜!

---

#### 4. í•¨ìˆ˜ Export ì¶”ê°€

**íŒŒì¼**: `connections/static/connections/home_tab_handlers.js` (line 748)

```javascript
window.calculateScheduleDatesFromGantt = calculateScheduleDatesFromGantt;  // NEW
```

---

## ë°±ì—”ë“œ ìˆ˜ì • (ì°¸ê³ ìš©)

ë°±ì—”ë“œ ê³„ì‚° ë¡œì§ë„ ê°œì„  ì‹œë„í–ˆìœ¼ë‚˜, ìµœì¢…ì ìœ¼ë¡œëŠ” í”„ë¡ íŠ¸ì—”ë“œ ê³„ì‚°ìœ¼ë¡œ ëŒ€ì²´í–ˆìŠµë‹ˆë‹¤.

**íŒŒì¼**: `connections/views.py` (lines 7291-7328)

**ì‹œë„ 1**: Activity â†’ ActivityObject ê°„ì ‘ ì ‘ê·¼
```python
activities = Activity.objects.filter(project=project)
for activity in activities:
    if activity.manual_start_date:
        activity_objects = ActivityObject.objects.filter(activity=activity, project=project)
        ao = activity_objects.first()  # ì²« ë²ˆì§¸ë§Œ ì‚¬ìš© (ë¬¸ì œ!)
        # ...
```

**ì‹œë„ 2**: ActivityObject ì§ì ‘ ì¡°íšŒ (ìµœì¢…)
```python
activity_objects = ActivityObject.objects.filter(project=project, is_active=True)

valid_dates = []
for ao in activity_objects:
    if ao.start_date and ao.end_date:
        valid_dates.append(ao.start_date)
        valid_dates.append(ao.end_date)

if valid_dates:
    start_date = min(valid_dates)
    end_date = max(valid_dates)
    total_days = (end_date - start_date).days + 1
```

**ë¬¸ì œì **:
- `ActivityObject.start_date`, `end_date` í•„ë“œê°€ ëŒ€ë¶€ë¶„ `None`
- ê°„íŠ¸ ì°¨íŠ¸ëŠ” ì´ í•„ë“œë“¤ì„ ì‚¬ìš©í•˜ì§€ ì•Šê³  í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ê³„ì‚°

**ê²°ë¡ **:
- ë°±ì—”ë“œ ê³„ì‚°ì€ ì‹¤íŒ¨
- í”„ë¡ íŠ¸ì—”ë“œ ê³„ì‚°(ê°„íŠ¸ ì°¨íŠ¸ ë°©ì‹)ì„ ì±„íƒ

---

## ë°ì´í„° íë¦„

### ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤ 1: í”„ë¡œì íŠ¸ ì„ íƒ (ê°„íŠ¸ ì°¨íŠ¸ ë°©ë¬¸ ì „)

```
1. ì‚¬ìš©ì: í™ˆ íƒ­ì—ì„œ í”„ë¡œì íŠ¸ "Sample" ì„ íƒ
   â†“
2. updateHomeCurrentProjectInfo() í˜¸ì¶œ
   â†“
3. loadHomeDashboardData(projectId) í˜¸ì¶œ
   â†“
4. [NEW] ActivityObjects API í˜¸ì¶œ (ì²˜ìŒ 1íšŒ)
   GET /connections/api/activity-objects/{projectId}/
   â†’ window.loadedActivityObjectsì— ì €ì¥
   â†“
5. Dashboard API í˜¸ì¶œ (ë¹„ìš© ë°ì´í„°)
   GET /connections/api/dashboard/{projectId}/
   â†“
6. calculateScheduleDatesFromGantt() í˜¸ì¶œ
   â†“
7. loadedActivityObjectsì—ì„œ ê³„ì‚°
   - activityDurationMap ìƒì„± (Activityë³„ duration í•©ì‚°)
   - manual_start_date ê¸°ì¤€ìœ¼ë¡œ start/end ë‚ ì§œ ê³„ì‚°
   - minDate, maxDate ì¶”ì¶œ
   - totalDays = Math.ceil((max - min) / ms_per_day)
   â†“
8. updateDashboardUI(data) í˜¸ì¶œ
   â†’ ê³µì • ê¸°ê°„ í‘œì‹œ: "2025. 11. 5. ~ 2025. 12. 15. (40ì¼)"
```

### ì‚¬ìš©ì ì‹œë‚˜ë¦¬ì˜¤ 2: ê°„íŠ¸ ì°¨íŠ¸ ë°©ë¬¸ í›„ í™ˆ ë³µê·€

```
1. ì‚¬ìš©ì: ê³µì •ê³„íš íƒ­ ë°©ë¬¸
   â†“
2. ê°„íŠ¸ ì°¨íŠ¸ ë Œë”ë§
   - buildGanttTasks() ì‹¤í–‰
   - window.ganttMinDate, ganttMaxDate ì „ì—­ ë³€ìˆ˜ ì„¤ì •
   â†“
3. ì‚¬ìš©ì: í™ˆ íƒ­ ë³µê·€
   â†“
4. loadHomeDashboardData(projectId) í˜¸ì¶œ
   â†“
5. ActivityObjects ì´ë¯¸ ë¡œë“œë¨ (ê±´ë„ˆëœ€)
   â†“
6. calculateScheduleDatesFromGantt() í˜¸ì¶œ
   â†“
7. window.ganttMinDate, ganttMaxDate ì‚¬ìš© (ë¹ ë¥¸ ê²½ë¡œ)
   - totalDays = Math.ceil((ganttMaxDate - ganttMinDate) / ms_per_day)
   â†“
8. updateDashboardUI(data) í˜¸ì¶œ
   â†’ ê³µì • ê¸°ê°„ í‘œì‹œ: "2025. 11. 5. ~ 2025. 12. 15. (40ì¼)"
```

---

## í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: í”„ë¡œì íŠ¸ ì„ íƒ ì§í›„ (ê°„íŠ¸ ì°¨íŠ¸ ë¯¸ë°©ë¬¸)

**í…ŒìŠ¤íŠ¸ ë‹¨ê³„**:
1. ë¸Œë¼ìš°ì € ì™„ì „ ìƒˆë¡œê³ ì¹¨ (Ctrl+Shift+R / Cmd+Shift+R)
2. í™ˆ íƒ­ì—ì„œ í”„ë¡œì íŠ¸ "Sample" ì„ íƒ
3. ëŒ€ì‹œë³´ë“œ ê³µì •ê³„íš ì¹´ë“œ í™•ì¸

**ì˜ˆìƒ ê²°ê³¼**:
- âœ… ê³µì • ê¸°ê°„ ì¦‰ì‹œ í‘œì‹œ: `2025. 11. 5. ~ 2025. 12. 15. (40ì¼)`
- âœ… "ë°ì´í„° ì—†ìŒ" í‘œì‹œ ì•ˆ ë‚˜íƒ€ë‚¨

**ë¸Œë¼ìš°ì € ì½˜ì†” ë¡œê·¸**:
```
[Dashboard] Loading dashboard data for project: fba942d7-dc1b-4526-a2b8-191494c776d6
[Dashboard] Loading activity objects first...
[Dashboard] Loaded 1 activity objects
[Dashboard] Dashboard data loaded: {success: true, data: {...}}
[Dashboard] Calculating schedule dates from gantt chart logic...
[Dashboard] Calculating from activity objects: 1
[Dashboard] Calculated dates: Wed Nov 05 2025 ... Mon Dec 15 2025 ... 40
[Dashboard] Updating dashboard UI with data: {schedule: {start_date_formatted: "2025. 11. 5.", end_date_formatted: "2025. 12. 15.", total_days: 40}}
[Dashboard] Dashboard UI updated successfully
```

---

### ì‹œë‚˜ë¦¬ì˜¤ 2: ê°„íŠ¸ ì°¨íŠ¸ ë°©ë¬¸ í›„ í™ˆ ë³µê·€

**í…ŒìŠ¤íŠ¸ ë‹¨ê³„**:
1. ê²°ê³¼ â†’ ê³µì •ê³„íš íƒ­ ì´ë™
2. ê°„íŠ¸ ì°¨íŠ¸ ë Œë”ë§ í™•ì¸
3. "í”„ë¡œì íŠ¸ ê¸°ê°„:" ê°’ í™•ì¸ â†’ `2025. 11. 5. ~ 2025. 12. 15. (40ì¼)`
4. í™ˆ íƒ­ìœ¼ë¡œ ë³µê·€
5. ëŒ€ì‹œë³´ë“œ ê³µì •ê³„íš ì¹´ë“œ í™•ì¸

**ì˜ˆìƒ ê²°ê³¼**:
- âœ… ê³µì • ê¸°ê°„: `2025. 11. 5. ~ 2025. 12. 15. (40ì¼)` (ê°„íŠ¸ ì°¨íŠ¸ì™€ ë™ì¼)
- âœ… ì¼ìˆ˜ ì¼ì¹˜: 40ì¼

**ë¸Œë¼ìš°ì € ì½˜ì†” ë¡œê·¸**:
```
[Dashboard] Loading dashboard data for project: fba942d7-dc1b-4526-a2b8-191494c776d6
[Dashboard] Dashboard data loaded: {success: true, data: {...}}
[Dashboard] Calculating schedule dates from gantt chart logic...
[Dashboard] Using existing gantt dates: Wed Nov 05 2025 ... Mon Dec 15 2025 ...
[Dashboard] Updating dashboard UI with data: {schedule: {start_date_formatted: "2025. 11. 5.", end_date_formatted: "2025. 12. 15.", total_days: 40}}
[Dashboard] Dashboard UI updated successfully
```

---

### ì‹œë‚˜ë¦¬ì˜¤ 3: ë‚ ì§œ ë°ì´í„° ì—†ëŠ” í”„ë¡œì íŠ¸

**í…ŒìŠ¤íŠ¸ ë‹¨ê³„**:
1. ActivityObjectsê°€ ì—†ëŠ” ìƒˆ í”„ë¡œì íŠ¸ ìƒì„±
2. í™ˆ íƒ­ì—ì„œ í”„ë¡œì íŠ¸ ì„ íƒ
3. ëŒ€ì‹œë³´ë“œ ê³µì •ê³„íš ì¹´ë“œ í™•ì¸

**ì˜ˆìƒ ê²°ê³¼**:
- âœ… "ë°ì´í„° ì—†ìŒ" í‘œì‹œ
- âœ… ì—ëŸ¬ ì—†ì´ ì •ìƒ ë™ì‘

---

## ìˆ˜ì • íŒŒì¼ ëª©ë¡

### í”„ë¡ íŠ¸ì—”ë“œ

1. **connections/static/connections/home_tab_handlers.js**
   - Lines 553-595: `loadHomeDashboardData()` í•¨ìˆ˜ ìˆ˜ì •
     - ActivityObjects ìë™ ë¡œë“œ ì¶”ê°€
     - `calculateScheduleDatesFromGantt()` í˜¸ì¶œ ì¶”ê°€
   - Lines 597-696: `calculateScheduleDatesFromGantt()` ì‹ ê·œ í•¨ìˆ˜ ì¶”ê°€
     - ê°„íŠ¸ ì°¨íŠ¸ ê³„ì‚° ë¡œì§ ì¬ì‚¬ìš©
     - Option 1: `window.ganttMinDate`/`ganttMaxDate` ì „ì—­ ë³€ìˆ˜ ì‚¬ìš©
     - Option 2: `loadedActivityObjects`ì—ì„œ ì§ì ‘ ê³„ì‚°
   - Line 609: ì¼ìˆ˜ ê³„ì‚° í†µì¼ (`+1` ì œê±°)
   - Line 687: ì¼ìˆ˜ ê³„ì‚° í†µì¼ (`+1` ì œê±°)
   - Line 748: `calculateScheduleDatesFromGantt` í•¨ìˆ˜ export ì¶”ê°€

### ë°±ì—”ë“œ (ì°¸ê³ ìš©, ìµœì¢…ì ìœ¼ë¡œ í”„ë¡ íŠ¸ì—”ë“œ ê³„ì‚° ì‚¬ìš©)

2. **connections/views.py**
   - Lines 7291-7328: `home_dashboard_api()` ê³µì • ê¸°ê°„ ê³„ì‚° ë¡œì§ ìˆ˜ì • ì‹œë„
     - ActivityObject ì§ì ‘ ì¡°íšŒ ë°©ì‹ìœ¼ë¡œ ë³€ê²½
     - ë””ë²„ê·¸ ë¡œê·¸ ì¶”ê°€
     - **ê²°ê³¼**: ì‚¬ìš©í•˜ì§€ ì•ŠìŒ (í”„ë¡ íŠ¸ì—”ë“œ ê³„ì‚°ìœ¼ë¡œ ë®ì–´ì”€)

---

## ê¸°ìˆ ì  ì„¸ë¶€ì‚¬í•­

### ë‚ ì§œ ê³„ì‚° ê³µì‹ ë¹„êµ

#### ê°„íŠ¸ ì°¨íŠ¸ (ì •ë‹µ)
```javascript
// gantt_chart_handlers.js line 511
const totalDays = Math.ceil((maxDate - minDate) / (1000 * 60 * 60 * 24));

// ì˜ˆì‹œ:
// minDate = 2025-11-05 00:00:00
// maxDate = 2025-12-15 00:00:00
// ì°¨ì´ = 40ì¼ 0ì‹œê°„ 0ë¶„ 0ì´ˆ
// ë°€ë¦¬ì´ˆ = 40 * 24 * 60 * 60 * 1000 = 3,456,000,000
// ì¼ = 3,456,000,000 / (1000 * 60 * 60 * 24) = 40.0
// Math.ceil(40.0) = 40ì¼ âœ…
```

#### ëŒ€ì‹œë³´ë“œ (ê¸°ì¡´ - ì˜¤ë¥˜)
```javascript
// ì˜ëª»ëœ ë°©ì‹ 1: Python ìŠ¤íƒ€ì¼
const totalDays = (end_date - start_date).days + 1;  // JavaScriptì— .days ì†ì„± ì—†ìŒ!

// ì˜ëª»ëœ ë°©ì‹ 2: +1 ì¶”ê°€
const totalDays = Math.ceil((maxDate - minDate) / (1000 * 60 * 60 * 24)) + 1;

// ì˜ˆì‹œ:
// Math.ceil(40.0) + 1 = 41ì¼ âŒ
```

#### ëŒ€ì‹œë³´ë“œ (ìˆ˜ì • í›„ - ì •ë‹µ)
```javascript
// home_tab_handlers.js line 687
const totalDays = Math.ceil((maxDate - minDate) / (1000 * 60 * 60 * 24));  // +1 ì œê±°!

// ì˜ˆì‹œ:
// Math.ceil(40.0) = 40ì¼ âœ…
```

---

### ActivityObject êµ¬ì¡°

```javascript
{
    id: "8e424221-fc4d-4e58-9775-f327d630e2c6",
    activity: {
        id: "75f7a1e9-da8f-4d90-b330-c9d8db9b7e67",
        code: "wk-002",
        name: "ì¡°ì ìì¬ì–‘ì¤‘",
        manual_start_date: "2025-11-05",  // â† ì‹œì‘ì¼ (ìˆ˜ë™ ì„¤ì •)
        duration_per_unit: 1.0
    },
    start_date: null,      // â† ë¹„ì–´ìˆìŒ (ì‚¬ìš© ë¶ˆê°€)
    end_date: null,        // â† ë¹„ì–´ìˆìŒ (ì‚¬ìš© ë¶ˆê°€)
    actual_duration: 39.69, // â† ì‹¤ì œ ì†Œìš” ì¼ìˆ˜ (ê³„ì‚°ë¨)
    quantity: 123.45,
    is_active: true
}
```

**ì¤‘ìš”**:
- `ActivityObject.start_date`, `end_date`ëŠ” ëŒ€ë¶€ë¶„ `null`
- ê°„íŠ¸ ì°¨íŠ¸ëŠ” `Activity.manual_start_date` + `ActivityObject.actual_duration`ìœ¼ë¡œ ê³„ì‚°
- ëŒ€ì‹œë³´ë“œë„ ë™ì¼í•œ ë°©ì‹ ì±„íƒ

---

### ì „ì—­ ë³€ìˆ˜ í™œìš©

**ê°„íŠ¸ ì°¨íŠ¸ì—ì„œ ì„¤ì •í•˜ëŠ” ì „ì—­ ë³€ìˆ˜**:
```javascript
// gantt_chart_handlers.js line 514-515
window.ganttMinDate = minDate;  // Date ê°ì²´
window.ganttMaxDate = maxDate;  // Date ê°ì²´
```

**ëŒ€ì‹œë³´ë“œì—ì„œ ì¬ì‚¬ìš©**:
```javascript
// home_tab_handlers.js line 605-616
if (window.ganttMinDate && window.ganttMaxDate) {
    const totalDays = Math.ceil((window.ganttMaxDate - window.ganttMinDate) / (1000 * 60 * 60 * 24));
    return {
        start_date_formatted: window.ganttMinDate.toLocaleDateString('ko-KR'),
        end_date_formatted: window.ganttMaxDate.toLocaleDateString('ko-KR'),
        total_days: totalDays
    };
}
```

**ì¥ì **:
- ê°„íŠ¸ ì°¨íŠ¸ ë°©ë¬¸ í›„ í™ˆ ë³µê·€ ì‹œ ì¬ê³„ì‚° ë¶ˆí•„ìš”
- ì„±ëŠ¥ ìµœì í™” (API í˜¸ì¶œ ì—†ìŒ)
- ì™„ë²½í•œ ì¼ì¹˜ ë³´ì¥

---

## í–¥í›„ ê°œì„  ì‚¬í•­

### 1. Project ì‹œì‘ì¼ ì„¤ì •
í˜„ì¬ëŠ” ì„ì‹œë¡œ `new Date()` (ì˜¤ëŠ˜) ì‚¬ìš©:
```javascript
const projectStartDate = new Date(); // ì„ì‹œ
```

**ê°œì„ ì•ˆ**:
- `Project` ëª¨ë¸ì— `start_date` í•„ë“œ ì¶”ê°€
- í”„ë¡œì íŠ¸ ì„¤ì •ì—ì„œ ì‚¬ìš©ìê°€ ì‹œì‘ì¼ ì§€ì •
- ë˜ëŠ” `Activity.manual_start_date`ì˜ ìµœì†Œê°’ ì‚¬ìš©

### 2. ì‘ì—…ì¼(Working Days) ê³ ë ¤
í˜„ì¬ëŠ” ë‹¬ë ¥ì¼(Calendar Days) ê³„ì‚°:
```javascript
const totalDays = Math.ceil((maxDate - minDate) / (1000 * 60 * 60 * 24));
```

**ê°œì„ ì•ˆ**:
- `ProjectCalendar` ëª¨ë¸ í™œìš©
- ì£¼ë§/ê³µíœ´ì¼ ì œì™¸í•œ ì‹¤ì œ ì‘ì—…ì¼ ê³„ì‚°
- ê°„íŠ¸ ì°¨íŠ¸ì˜ `addWorkingDays()` í•¨ìˆ˜ ì¬ì‚¬ìš©

### 3. ActivityObject.start_date, end_date ìë™ ê³„ì‚°
í˜„ì¬ëŠ” í•„ë“œê°€ ë¹„ì–´ìˆìŒ:
```javascript
start_date: null,
end_date: null
```

**ê°œì„ ì•ˆ**:
- ë°±ì—”ë“œì—ì„œ `Activity.manual_start_date` + `actual_duration` ê³„ì‚°
- ì €ì¥ ì‹œ ìë™ìœ¼ë¡œ `start_date`, `end_date` ì—…ë°ì´íŠ¸
- í”„ë¡ íŠ¸ì—”ë“œ/ë°±ì—”ë“œ ê³„ì‚° ë¡œì§ í†µì¼

### 4. ê³µì • ì§„í–‰ë¥  í‘œì‹œ
ëŒ€ì‹œë³´ë“œì— ì¶”ê°€í•  ë°ì´í„°:
- ì™„ë£Œëœ ActivityObject ìˆ˜ / ì „ì²´ ActivityObject ìˆ˜
- ê²½ê³¼ ì¼ìˆ˜ / ì´ ê³µê¸°
- ì§„í–‰ë¥  ë°” UI ì¶”ê°€

---

## ê´€ë ¨ ë¬¸ì„œ

- ì´ì „ ì‘ì—…: `81_2025-11-05_í™ˆ_ëŒ€ì‹œë³´ë“œ_êµ¬í˜„.md`
- ê°„íŠ¸ ì°¨íŠ¸ ë¡œì§: `connections/static/connections/gantt_chart_handlers.js` lines 287-511
- ActivityObject ëª¨ë¸: `connections/models.py` lines 493-523
- Activity ëª¨ë¸: `connections/models.py` lines 389-422

---

## ì»¤ë°‹ ë©”ì‹œì§€

```
Fix home dashboard schedule calculation to match Gantt chart

Problem:
- Dashboard schedule dates not showing until visiting Gantt tab
- Total days mismatch: Gantt (40 days) vs Dashboard (41 days)
- Root cause: ActivityObject.start_date/end_date fields are mostly null

Solution:
- Frontend calculation using Gantt chart logic (reuse existing code)
- Auto-load ActivityObjects via API before calculating schedule
- Use Activity.manual_start_date + ActivityObject.actual_duration
- Match total_days formula: Math.ceil((max - min) / ms_per_day) without +1

Changes:
1. connections/static/connections/home_tab_handlers.js
   - loadHomeDashboardData(): Auto-fetch ActivityObjects if not loaded
   - calculateScheduleDatesFromGantt(): New function reusing Gantt logic
     - Option 1: Use window.ganttMinDate/ganttMaxDate if available
     - Option 2: Calculate from loadedActivityObjects directly
   - Fix total_days calculation (remove +1 to match Gantt chart)
   - Export calculateScheduleDatesFromGantt to window scope

2. connections/views.py (reference only, not used)
   - home_dashboard_api(): Attempted backend calculation (replaced by frontend)

Result:
- Dashboard schedule shows immediately without visiting Gantt tab
- Total days now match: Both show "40ì¼" for 2025.11.5 ~ 2025.12.15
- Consistent date calculation across all tabs

Test:
1. Select project on Home tab â†’ Schedule displays instantly
2. Visit Gantt tab â†’ "í”„ë¡œì íŠ¸ ê¸°ê°„: 40ì¼"
3. Return to Home tab â†’ Dashboard shows "40ì¼" (same value)

ğŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
```
