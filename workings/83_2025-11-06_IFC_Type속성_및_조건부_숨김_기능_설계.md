# IFC Type ì†ì„± ë° ì¡°ê±´ë¶€ ìˆ¨ê¹€ ê¸°ëŠ¥ ì„¤ê³„

**ë‚ ì§œ**: 2025-11-06
**ì‘ì—…ì**: Claude (AI Assistant)
**ìƒíƒœ**: ì„¤ê³„ ì™„ë£Œ, ì¼ë¶€ êµ¬í˜„ (Blender Addon)

## ê°œìš”

IFC íŒŒì¼ ë¡œë“œ ì‹œ ë‘ ê°€ì§€ ì£¼ìš” ê¸°ëŠ¥ ì¶”ê°€:

1. **Type ì†ì„± í‰íƒ„í™” í‘œì‹œ**: IfcWallì˜ ì—°ê´€ IfcWallType ì†ì„±ì„ `BIM.Type.Attributes.*` í˜•ì‹ìœ¼ë¡œ í‘œì‹œ
2. **3D ë·°ì–´ ì¡°ê±´ë¶€ ìˆ¨ê¹€**: íŠ¹ì • ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ê°ì²´ë¥¼ ìë™ìœ¼ë¡œ ìˆ¨ê¹€ ì²˜ë¦¬

## ìš”êµ¬ì‚¬í•­ ìƒì„¸

### 1. Type ì†ì„± í‰íƒ„í™”

#### í˜„í™©
- **ë¬¸ì œ**: í˜„ì¬ëŠ” IFC ê°ì²´(ì˜ˆ: `IfcWall`)ì˜ ìì²´ ì†ì„±ë§Œ ìˆ˜ì§‘
- **ëˆ„ë½**: ì—°ê´€ëœ Type ê°ì²´(ì˜ˆ: `IfcWallType`)ì˜ ì†ì„± ë¯¸ìˆ˜ì§‘

#### ëª©í‘œ
Type ê°ì²´ì˜ ì†ì„±ì„ í‰íƒ„í™”í•˜ì—¬ ê°ì²´ ë°ì´í„°ì— í¬í•¨:

**ëª…ëª… ê·œì¹™**:
- ê¸°ì¡´ ê°ì²´ ì†ì„±: `BIM.Attributes.*`, `BIM.Parameters.*`, `BIM.PropertySet.*`
- Type ê°ì²´ ì†ì„±: `BIM.Type.Attributes.*`, `BIM.Type.Parameters.*`, `BIM.Type.PropertySet.*`

**ì˜ˆì‹œ**:
```javascript
// IfcWall ê°ì²´
{
  // ê¸°ì¡´: ê°ì²´ ìì²´ ì†ì„±
  "BIM.Attributes.Name": "Wall-001",
  "BIM.Parameters.Mark": "A-1",
  "BIM.PropertySet.Pset_WallCommon__IsExternal": true,

  // ì‹ ê·œ: ì—°ê´€ëœ IfcWallType ì†ì„±
  "BIM.Type.Attributes.Name": "Basic Wall: Generic - 200mm",
  "BIM.Type.Attributes.Description": "Standard concrete wall",
  "BIM.Type.PropertySet.Pset_WallTypeCommon__ThermalTransmittance": 2.5,
  "BIM.Type.PropertySet.Pset_WallTypeCommon__LoadBearing": true
}
```

#### ë°ì´í„° êµ¬ì¡°

```json
{
  "Name": "Wall-001",
  "IfcClass": "IfcWall",
  "Attributes": {
    "Name": "Wall-001",
    "Description": null,
    "Tag": "W-001",
    "PredefinedType": "SOLIDWALL"
  },
  "PropertySet": {
    "Pset_WallCommon__IsExternal": true,
    "Pset_WallCommon__LoadBearing": true
  },
  "Type": {
    "Name": "Basic Wall: Generic - 200mm",
    "IfcClass": "IfcWallType",
    "Attributes": {
      "Name": "Basic Wall: Generic - 200mm",
      "Description": "Standard concrete wall",
      "ApplicableOccurrence": null,
      "ElementType": "SOLIDWALL"
    },
    "PropertySet": {
      "Pset_WallTypeCommon__ThermalTransmittance": 2.5,
      "Pset_WallTypeCommon__LoadBearing": true,
      "Pset_WallTypeCommon__FireRating": "2HR"
    }
  }
}
```

---

### 2. 3D ë·°ì–´ ì¡°ê±´ë¶€ ìˆ¨ê¹€

#### í˜„í™©
- **ë¬¸ì œ**: ëª¨ë“  IFC ê°ì²´ê°€ 3D ë·°ì–´ì— í‘œì‹œë¨
- **ë¶ˆí¸**: ì„ì‹œ ê°ì²´, ë§í¬ ê°ì²´ ë“± ë¶ˆí•„ìš”í•œ ìš”ì†Œë„ í‘œì‹œ

#### ëª©í‘œ
íŠ¹ì • ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ê°ì²´ë¥¼ ë¡œë“œ ì‹œ ìë™ ìˆ¨ê¹€:

**ì¡°ê±´ ì˜ˆì‹œ**:
- `BIM.Attributes.Name contains "Temporary"` â†’ ìˆ¨ê¹€
- `BIM.Parameters.Workset contains "ë§í¬"` â†’ ìˆ¨ê¹€
- `BIM.Type.Attributes.Name == "Hidden Type"` â†’ ìˆ¨ê¹€
- `BIM.PropertySet.Pset_Common__IsExternal == false` â†’ ìˆ¨ê¹€

**ì„¤ì • ìœ„ì¹˜**:
- í”„ë¡œì íŠ¸ë³„ ì„¤ì • (Project ëª¨ë¸ì— ì €ì¥)
- ì „ì—­ ì„¤ì • (User Preferences)

**UI ìœ„ì¹˜**:
- BIM ì›ë³¸ë°ì´í„° íƒ­ â†’ ì„¤ì • ë²„íŠ¼
- ë˜ëŠ” í”„ë¡œì íŠ¸ ê´€ë¦¬ â†’ ê°€ì‹œì„± ì„¤ì •

---

## êµ¬í˜„ ê³„íš

### Phase 1: Blender Addon - Type Attributes ìˆ˜ì§‘ âœ…

**íŒŒì¼**: `CostEstimator_BlenderAddon_453/__init__.py`
**í•¨ìˆ˜**: `serialize_ifc_elements_to_string_list()` (lines 394-438)

**ë³€ê²½ ì‚¬í•­**:
```python
# â–¼â–¼â–¼ Type ì •ë³´ ì¶”ì¶œ (í™•ì¥: Attributes í¬í•¨) â–¼â–¼â–¼
if hasattr(element, 'IsTypedBy') and element.IsTypedBy:
    type_definition = element.IsTypedBy[0]
    if type_definition and type_definition.is_a("IfcRelDefinesByType"):
        relating_type = type_definition.RelatingType
        if relating_type:
            # ê¸°ë³¸ Type ì •ë³´
            element_dict["Type"]["Name"] = relating_type.Name
            element_dict["Type"]["IfcClass"] = relating_type.is_a()

            # â–¼â–¼â–¼ [NEW] Type Attributes ì¶”ì¶œ â–¼â–¼â–¼
            element_dict["Type"]["Attributes"] = {}
            type_info = relating_type.get_info()

            for attr_name, attr_value in type_info.items():
                # ë‚´ë¶€ ì†ì„± ì œì™¸
                if attr_name in ['type', 'id', 'GlobalId']:
                    continue

                # ê´€ê³„í˜• ì†ì„± ì œì™¸
                if isinstance(attr_value, (list, tuple)) and attr_name[0].isupper():
                    continue

                # Attributes ì¶”ê°€
                if hasattr(attr_value, 'is_a'):
                    element_dict["Type"]["Attributes"][attr_name] = f"{attr_value.is_a()}: {getattr(attr_value, 'Name', str(attr_value))}"
                elif attr_value is not None:
                    element_dict["Type"]["Attributes"][attr_name] = attr_value
                else:
                    element_dict["Type"]["Attributes"][attr_name] = None

            # Typeì˜ PropertySets ì¶”ì¶œ
            element_dict["Type"]["PropertySet"] = {}
            if hasattr(relating_type, 'HasPropertySets') and relating_type.HasPropertySets:
                for prop_set in relating_type.HasPropertySets:
                    if prop_set and prop_set.is_a("IfcPropertySet"):
                        if hasattr(prop_set, 'HasProperties') and prop_set.HasProperties:
                            for prop in prop_set.HasProperties:
                                if prop.is_a("IfcPropertySingleValue"):
                                    prop_key = f"{prop_set.Name}__{prop.Name}"
                                    element_dict["Type"]["PropertySet"][prop_key] = prop.NominalValue.wrappedValue if prop.NominalValue else None
```

**ê²°ê³¼**:
- `raw_data.Type.Attributes` ì¶”ê°€
- `raw_data.Type.PropertySet` êµ¬ì¡° ê°œì„ 

---

### Phase 2: Revit Addin - Type Properties ìˆ˜ì§‘ (TODO)

**íŒŒì¼**: `CostEstimator_RevitAddin_2026/MainTools/QuantityTakeoff_web/RevitDataCollector.cs` (ì˜ˆìƒ)
**ìœ„ì¹˜**: Element ë°ì´í„° ìˆ˜ì§‘ ë¶€ë¶„

**í•„ìš” ì‘ì—…**:
```csharp
// ElementType ê°€ì ¸ì˜¤ê¸°
ElementId typeId = element.GetTypeId();
if (typeId != null && typeId != ElementId.InvalidElementId)
{
    ElementType elementType = doc.GetElement(typeId) as ElementType;
    if (elementType != null)
    {
        var typeData = new Dictionary<string, object>();
        typeData["Name"] = elementType.Name;
        typeData["FamilyName"] = elementType.FamilyName;

        // Type Attributes
        var typeAttributes = new Dictionary<string, object>();
        // ... ElementTypeì˜ ê¸°ë³¸ ì†ì„± ìˆ˜ì§‘ ...
        typeData["Attributes"] = typeAttributes;

        // Type Parameters
        var typeParams = new Dictionary<string, object>();
        foreach (Parameter param in elementType.Parameters)
        {
            if (param.HasValue)
            {
                string paramName = param.Definition.Name;
                object paramValue = GetParameterValue(param);
                typeParams[paramName] = paramValue;
            }
        }
        typeData["Parameters"] = typeParams;

        elementDict["Type"] = typeData;
    }
}
```

**ì°¸ê³ **: Revit API í™•ì¸ í•„ìš”
- `Element.GetTypeId()`
- `ElementType` í´ë˜ìŠ¤
- Typeì˜ Parameters ì ‘ê·¼ ë°©ë²•

---

### Phase 3: ë°±ì—”ë“œ - Type ë°ì´í„° ì €ì¥ (ì™„ë£Œ ì˜ˆìƒ)

**íŒŒì¼**: `connections/models.py`
**ëª¨ë¸**: `RawElement`

**í˜„í™©**:
- `raw_data` JSONFieldì— ëª¨ë“  ë°ì´í„° ì €ì¥
- ì´ë¯¸ `Type` í‚¤ê°€ ì¡´ì¬í•˜ë©° êµ¬ì¡° í™•ì¥ ê°€ëŠ¥

**ë³€ê²½ ë¶ˆí•„ìš”**:
- ê¸°ì¡´ êµ¬ì¡°ë¡œ Type.Attributes, Type.PropertySet ì €ì¥ ê°€ëŠ¥
- JSONFieldì´ë¯€ë¡œ ë™ì  í™•ì¥ ì§€ì›

---

### Phase 4: í”„ë¡ íŠ¸ì—”ë“œ - Type ì†ì„± í‘œì‹œ (TODO)

#### 4.1. Property Options ìƒì„±

**íŒŒì¼**: `connections/static/connections/ui.js`
**í•¨ìˆ˜**: `generateBIMPropertyOptions()`

**í˜„ì¬ êµ¬ì¡°**:
```javascript
function generateBIMPropertyOptions() {
    const options = [];

    // window.allRevitDataì™€ window.currentRawElement í™•ì¸
    const dataSource = window.currentRawElement ? [window.currentRawElement] : window.allRevitData;

    if (!dataSource || dataSource.length === 0) {
        return [];
    }

    const allKeys = new Set();

    dataSource.forEach(elem => {
        const raw = elem.raw_data || {};

        // Attributes
        Object.keys(raw.Attributes || {}).forEach(key => {
            allKeys.add(`BIM.Attributes.${key}`);
        });

        // Parameters
        Object.keys(raw.Parameters || {}).forEach(key => {
            allKeys.add(`BIM.Parameters.${key}`);
        });

        // PropertySet
        Object.keys(raw.PropertySet || {}).forEach(key => {
            allKeys.add(`BIM.PropertySet.${key}`);
        });

        // â–¼â–¼â–¼ [NEW] Type ì†ì„± ì¶”ê°€ â–¼â–¼â–¼
        if (raw.Type) {
            // Type.Attributes
            Object.keys(raw.Type.Attributes || {}).forEach(key => {
                allKeys.add(`BIM.Type.Attributes.${key}`);
            });

            // Type.PropertySet
            Object.keys(raw.Type.PropertySet || {}).forEach(key => {
                allKeys.add(`BIM.Type.PropertySet.${key}`);
            });
        }
        // â–²â–²â–² [NEW] ì—¬ê¸°ê¹Œì§€ â–²â–²â–²
    });

    // ê·¸ë£¹í™”
    const groups = {
        'BIM.Attributes': [],
        'BIM.Parameters': [],
        'BIM.PropertySet': [],
        'BIM.Type.Attributes': [],
        'BIM.Type.PropertySet': []
    };

    Array.from(allKeys).sort().forEach(key => {
        if (key.startsWith('BIM.Type.Attributes.')) {
            groups['BIM.Type.Attributes'].push({ label: key, value: key });
        } else if (key.startsWith('BIM.Type.PropertySet.')) {
            groups['BIM.Type.PropertySet'].push({ label: key, value: key });
        } else if (key.startsWith('BIM.Attributes.')) {
            groups['BIM.Attributes'].push({ label: key, value: key });
        } else if (key.startsWith('BIM.Parameters.')) {
            groups['BIM.Parameters'].push({ label: key, value: key });
        } else if (key.startsWith('BIM.PropertySet.')) {
            groups['BIM.PropertySet'].push({ label: key, value: key });
        }
    });

    return [
        { group: 'BIM Attributes', options: groups['BIM.Attributes'] },
        { group: 'BIM Parameters', options: groups['BIM.Parameters'] },
        { group: 'BIM PropertySet', options: groups['BIM.PropertySet'] },
        { group: 'BIM Type Attributes', options: groups['BIM.Type.Attributes'] },
        { group: 'BIM Type PropertySet', options: groups['BIM.Type.PropertySet'] }
    ];
}
```

#### 4.2. Property ê°’ ì¶”ì¶œ

**íŒŒì¼**: `connections/static/connections/ui.js`
**í•¨ìˆ˜**: `getValueForItem(item, field)`, `getInternalFieldName(displayField)`

**ë³€ê²½**:
```javascript
function getInternalFieldName(displayField) {
    // ... ê¸°ì¡´ ì½”ë“œ ...

    // â–¼â–¼â–¼ [NEW] BIM.Type.* ì²˜ë¦¬ â–¼â–¼â–¼
    if (displayField.startsWith('BIM.Type.Attributes.')) {
        return displayField.substring(20); // 'BIM.Type.Attributes.' ì œê±° â†’ Type pathë¡œ ì ‘ê·¼
    }
    if (displayField.startsWith('BIM.Type.PropertySet.')) {
        return displayField.substring(21); // 'BIM.Type.PropertySet.' ì œê±°
    }
    // â–²â–²â–² [NEW] ì—¬ê¸°ê¹Œì§€ â–²â–²â–²

    // ... ê¸°ì¡´ ì½”ë“œ ...
}

function getValueForItem(item, field) {
    const raw_data = item.raw_data || {};
    const internalField = getInternalFieldName(field);

    // â–¼â–¼â–¼ [NEW] Type ì†ì„± ì ‘ê·¼ â–¼â–¼â–¼
    if (field.startsWith('BIM.Type.')) {
        if (!raw_data.Type) return '';

        if (field.startsWith('BIM.Type.Attributes.')) {
            const attrKey = field.substring(20); // 'BIM.Type.Attributes.' ì œê±°
            return raw_data.Type.Attributes?.[attrKey] ?? '';
        }

        if (field.startsWith('BIM.Type.PropertySet.')) {
            const propKey = field.substring(21); // 'BIM.Type.PropertySet.' ì œê±°
            return raw_data.Type.PropertySet?.[propKey] ?? '';
        }
    }
    // â–²â–²â–² [NEW] ì—¬ê¸°ê¹Œì§€ â–²â–²â–²

    // ... ê¸°ì¡´ ì½”ë“œ ...
}
```

---

### Phase 5: ì¡°ê±´ë¶€ ìˆ¨ê¹€ UI (TODO)

#### 5.1. í”„ë¡œì íŠ¸ ì„¤ì • ëª¨ë¸ í™•ì¥

**íŒŒì¼**: `connections/models.py`
**ëª¨ë¸**: `Project`

**ì¶”ê°€ í•„ë“œ**:
```python
class Project(models.Model):
    # ... ê¸°ì¡´ í•„ë“œ ...

    # â–¼â–¼â–¼ [NEW] ê°€ì‹œì„± í•„í„° ì„¤ì • â–¼â–¼â–¼
    visibility_filters = models.JSONField(
        default=list,
        blank=True,
        help_text="3D ë·°ì–´ì—ì„œ ìˆ¨ê¸¸ ê°ì²´ ì¡°ê±´ (ë¦¬ìŠ¤íŠ¸)"
    )
    # ì˜ˆì‹œ ë°ì´í„°:
    # [
    #   {"property": "BIM.Attributes.Name", "operator": "contains", "value": "Temporary"},
    #   {"property": "BIM.Parameters.Workset", "operator": "contains", "value": "ë§í¬"},
    #   {"property": "BIM.Type.Attributes.Name", "operator": "==", "value": "Hidden Type"}
    # ]
    # â–²â–²â–² [NEW] ì—¬ê¸°ê¹Œì§€ â–²â–²â–²
```

#### 5.2. ì„¤ì • UI

**íŒŒì¼**: `connections/templates/revit_control.html`
**ìœ„ì¹˜**: BIM ì›ë³¸ë°ì´í„° íƒ­ ë˜ëŠ” í”„ë¡œì íŠ¸ ì„¤ì •

**UI êµ¬ì¡°**:
```html
<div id="visibility-filters-section">
    <h3>3D ë·°ì–´ ê°€ì‹œì„± í•„í„°</h3>
    <p>ì•„ë˜ ì¡°ê±´ì„ ë§Œì¡±í•˜ëŠ” ê°ì²´ëŠ” 3D ë·°ì–´ì—ì„œ ìë™ìœ¼ë¡œ ìˆ¨ê²¨ì§‘ë‹ˆë‹¤.</p>

    <table id="visibility-filters-table">
        <thead>
            <tr>
                <th>ì†ì„±</th>
                <th>ì—°ì‚°ì</th>
                <th>ê°’</th>
                <th>ì‘ì—…</th>
            </tr>
        </thead>
        <tbody id="visibility-filters-tbody">
            <!-- ë™ì  ìƒì„± -->
        </tbody>
    </table>

    <button id="add-visibility-filter-btn">+ ì¡°ê±´ ì¶”ê°€</button>
    <button id="save-visibility-filters-btn">ì €ì¥</button>
</div>
```

**JavaScript**:
```javascript
// connections/static/connections/data_management_handlers.js

function renderVisibilityFilters() {
    const tbody = document.getElementById('visibility-filters-tbody');
    if (!tbody) return;

    tbody.innerHTML = '';

    const filters = window.currentProjectVisibilityFilters || [];

    filters.forEach((filter, index) => {
        const row = document.createElement('tr');
        row.innerHTML = `
            <td>
                <select class="filter-property" data-index="${index}">
                    <option value="">-- ì†ì„± ì„ íƒ --</option>
                    ${generatePropertyOptions()}
                </select>
            </td>
            <td>
                <select class="filter-operator" data-index="${index}">
                    <option value="==">ê°™ìŒ (==)</option>
                    <option value="!=">ê°™ì§€ ì•ŠìŒ (!=)</option>
                    <option value="contains">í¬í•¨ (contains)</option>
                    <option value="!contains">í¬í•¨í•˜ì§€ ì•ŠìŒ (!contains)</option>
                    <option value="startsWith">ì‹œì‘ (startsWith)</option>
                    <option value="endsWith">ë (endsWith)</option>
                </select>
            </td>
            <td>
                <input type="text" class="filter-value" data-index="${index}" value="${filter.value}">
            </td>
            <td>
                <button class="remove-filter-btn" data-index="${index}">ì‚­ì œ</button>
            </td>
        `;
        tbody.appendChild(row);
    });
}

function saveVisibilityFilters() {
    const filters = [];

    document.querySelectorAll('#visibility-filters-tbody tr').forEach(row => {
        const property = row.querySelector('.filter-property').value;
        const operator = row.querySelector('.filter-operator').value;
        const value = row.querySelector('.filter-value').value;

        if (property && value) {
            filters.push({ property, operator, value });
        }
    });

    // APIë¡œ ì €ì¥
    fetch(`/connections/api/projects/${currentProjectId}/`, {
        method: 'PATCH',
        headers: {
            'Content-Type': 'application/json',
            'X-CSRFToken': getCSRFToken()
        },
        body: JSON.stringify({ visibility_filters: filters })
    }).then(response => {
        if (response.ok) {
            showToast('ê°€ì‹œì„± í•„í„°ê°€ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤.', 'success');
            window.currentProjectVisibilityFilters = filters;

            // 3D ë·°ì–´ ë¦¬ë¡œë“œ
            reloadBimGeometry();
        }
    });
}
```

#### 5.3. 3D ë·°ì–´ í•„í„° ì ìš©

**íŒŒì¼**: `connections/static/connections/three_d_viewer.js`
**í•¨ìˆ˜**: `loadBimGeometry()` ë˜ëŠ” `loadBimGeometryWithFilters()`

**ì ìš© ë¡œì§**:
```javascript
function loadBimGeometry() {
    console.log('[3D Viewer] Loading BIM geometry from allRevitData...');

    if (!window.allRevitData || window.allRevitData.length === 0) {
        console.warn('[3D Viewer] No BIM data available');
        return;
    }

    // â–¼â–¼â–¼ [NEW] ê°€ì‹œì„± í•„í„° ì ìš© â–¼â–¼â–¼
    const visibilityFilters = window.currentProjectVisibilityFilters || [];
    const hiddenIds = new Set();

    if (visibilityFilters.length > 0) {
        console.log('[3D Viewer] Applying visibility filters:', visibilityFilters);

        window.allRevitData.forEach(elem => {
            const shouldHide = visibilityFilters.some(filter => {
                const value = getValueForItem(elem, filter.property);
                return matchesFilterCondition(value, filter.operator, filter.value);
            });

            if (shouldHide) {
                hiddenIds.add(elem.id);
                console.log('[3D Viewer] Hiding element:', elem.id, elem.raw_data?.Name);
            }
        });

        console.log('[3D Viewer] Total hidden by filters:', hiddenIds.size);
    }
    // â–²â–²â–² [NEW] ì—¬ê¸°ê¹Œì§€ â–²â–²â–²

    // ê¸°ì¡´ split ê°ì²´ í•„í„°ë§ê³¼ ë³‘í•©
    const splitHiddenIds = new Set(window.rawElementIdsWithSplits || []);
    const allHiddenIds = new Set([...hiddenIds, ...splitHiddenIds]);

    // ê¸°ì¡´ ë¡œì§ì— allHiddenIds ì ìš©
    const objectsToLoad = window.allRevitData.filter(elem => !allHiddenIds.has(elem.id));

    console.log('[3D Viewer] Total objects to load:', objectsToLoad.length);
    console.log('[3D Viewer] Total objects hidden:', allHiddenIds.size);

    // ... ê¸°ì¡´ ë¡œë“œ ë¡œì§ ...
}

function matchesFilterCondition(value, operator, filterValue) {
    const valueStr = String(value || '').toLowerCase();
    const filterStr = String(filterValue || '').toLowerCase();

    switch (operator) {
        case '==':
            return valueStr === filterStr;
        case '!=':
            return valueStr !== filterStr;
        case 'contains':
            return valueStr.includes(filterStr);
        case '!contains':
            return !valueStr.includes(filterStr);
        case 'startsWith':
            return valueStr.startsWith(filterStr);
        case 'endsWith':
            return valueStr.endsWith(filterStr);
        default:
            return false;
    }
}
```

---

## ë°ì´í„° íë¦„

### Type ì†ì„± ìˆ˜ì§‘ ë° í‘œì‹œ

```
1. IFC íŒŒì¼ ë¡œë“œ (Blender/Revit)
   â†“
2. Type ê´€ê³„ ì¶”ì 
   - Blender: element.IsTypedBy â†’ relating_type
   - Revit: element.GetTypeId() â†’ ElementType
   â†“
3. Type ì†ì„± ìˆ˜ì§‘
   - Attributes: get_info() / ElementType properties
   - PropertySets: HasPropertySets / Parameters
   â†“
4. JSON êµ¬ì¡° ìƒì„±
   {
     "Type": {
       "Name": "...",
       "Attributes": {...},
       "PropertySet": {...}
     }
   }
   â†“
5. WebSocket ì „ì†¡
   â†“
6. ë°±ì—”ë“œ ì €ì¥ (RawElement.raw_data)
   â†“
7. í”„ë¡ íŠ¸ì—”ë“œ í‘œì‹œ
   - generateBIMPropertyOptions(): BIM.Type.* ì˜µì…˜ ìƒì„±
   - getValueForItem(): raw_data.Type.* ì ‘ê·¼
   - Field Selection: Type ì†ì„± ì„ íƒ ê°€ëŠ¥
   - Helper Panel: Type ì†ì„± í‘œì‹œ
```

### ì¡°ê±´ë¶€ ìˆ¨ê¹€ ì ìš©

```
1. í”„ë¡œì íŠ¸ ì„¤ì • UI
   - ì‚¬ìš©ì: í•„í„° ì¡°ê±´ ì¶”ê°€
   - ì˜ˆ: "BIM.Attributes.Name contains Temporary"
   â†“
2. ì €ì¥
   - Project.visibility_filters JSON ì—…ë°ì´íŠ¸
   â†“
3. í”„ë¡œì íŠ¸ ë¡œë“œ ì‹œ
   - window.currentProjectVisibilityFilters ì„¤ì •
   â†“
4. 3D ë·°ì–´ ë¡œë“œ
   - loadBimGeometry() í˜¸ì¶œ
   â†“
5. í•„í„° í‰ê°€
   - ê° ìš”ì†Œì— ëŒ€í•´ ì¡°ê±´ ê²€ì‚¬
   - matchesFilterCondition(value, operator, filterValue)
   â†“
6. ìˆ¨ê¹€ ì²˜ë¦¬
   - ì¡°ê±´ ë§Œì¡± ì‹œ hiddenIdsì— ì¶”ê°€
   - 3D ê°ì²´ ìƒì„± ì œì™¸
   â†“
7. ê²°ê³¼
   - ì¡°ê±´ì— ë§ëŠ” ê°ì²´ëŠ” 3D ë·°ì–´ì— í‘œì‹œ ì•ˆ ë¨
   - ë°ì´í„°ëŠ” ì—¬ì „íˆ allRevitDataì— ì¡´ì¬ (í•„í„°ë§Œ ì ìš©)
```

---

## í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

### ì‹œë‚˜ë¦¬ì˜¤ 1: Type ì†ì„± í™•ì¸

**ì¤€ë¹„**:
1. IFC íŒŒì¼ì— Type ì •ë³´ê°€ ìˆëŠ” ê°ì²´ í¬í•¨ (IfcWall, IfcWallType ë“±)
2. Blenderì—ì„œ IFC íŒŒì¼ ë¡œë“œ
3. Cost Estimator Connectorë¡œ ë°ì´í„° ì „ì†¡

**í…ŒìŠ¤íŠ¸ ë‹¨ê³„**:
1. BIM ì›ë³¸ë°ì´í„° íƒ­ ì´ë™
2. Helper Panelì—ì„œ ê°ì²´ ì„ íƒ
3. Type ì„¹ì…˜ í™•ì¸
4. ì†ì„± ë£°ì…‹ì—ì„œ "í•„ë“œ ì„ íƒ" í´ë¦­
5. **ì˜ˆìƒ**: "BIM Type Attributes" ê·¸ë£¹ í‘œì‹œ
6. **ì˜ˆìƒ**: `BIM.Type.Attributes.Name`, `BIM.Type.Attributes.Description` ë“± í‘œì‹œ

**ê²°ê³¼ í™•ì¸**:
- âœ… Type.Attributesê°€ ì˜¬ë°”ë¥´ê²Œ ìˆ˜ì§‘ë¨
- âœ… Type.PropertySetì´ ì˜¬ë°”ë¥´ê²Œ ìˆ˜ì§‘ë¨
- âœ… í”„ë¡ íŠ¸ì—”ë“œì—ì„œ Type ì†ì„± ì„ íƒ ê°€ëŠ¥
- âœ… ë£°ì…‹ì—ì„œ Type ì†ì„± ì‚¬ìš© ê°€ëŠ¥

---

### ì‹œë‚˜ë¦¬ì˜¤ 2: ì¡°ê±´ë¶€ ìˆ¨ê¹€ ì„¤ì •

**ì¤€ë¹„**:
1. "Temporary"ê°€ ì´ë¦„ì— í¬í•¨ëœ IFC ê°ì²´ ìƒì„±
2. IFC íŒŒì¼ ë¡œë“œ

**í…ŒìŠ¤íŠ¸ ë‹¨ê³„**:
1. BIM ì›ë³¸ë°ì´í„° íƒ­ â†’ ê°€ì‹œì„± í•„í„° ì„¹ì…˜
2. "ì¡°ê±´ ì¶”ê°€" ë²„íŠ¼ í´ë¦­
3. ì†ì„±: `BIM.Attributes.Name`
4. ì—°ì‚°ì: `contains`
5. ê°’: `Temporary`
6. "ì €ì¥" ë²„íŠ¼ í´ë¦­
7. 3D ë·°ì–´ í™•ì¸

**ì˜ˆìƒ ê²°ê³¼**:
- âœ… ì´ë¦„ì— "Temporary" í¬í•¨ëœ ê°ì²´ê°€ 3D ë·°ì–´ì— í‘œì‹œ ì•ˆ ë¨
- âœ… BIM ì›ë³¸ë°ì´í„° í…Œì´ë¸”ì—ëŠ” ì—¬ì „íˆ í‘œì‹œë¨ (ë°ì´í„°ëŠ” ì¡´ì¬)
- âœ… í•„í„° ì„¤ì •ì´ í”„ë¡œì íŠ¸ì— ì €ì¥ë¨ (ì¬ë¡œë“œ í›„ì—ë„ ìœ ì§€)

---

### ì‹œë‚˜ë¦¬ì˜¤ 3: Type ê¸°ë°˜ í•„í„°ë§

**ì¤€ë¹„**:
1. IFC íŒŒì¼ì— "Hidden Type"ì´ë¼ëŠ” Type ì´ë¦„ì„ ê°€ì§„ ê°ì²´ ìƒì„±

**í…ŒìŠ¤íŠ¸ ë‹¨ê³„**:
1. ê°€ì‹œì„± í•„í„° ì¶”ê°€
2. ì†ì„±: `BIM.Type.Attributes.Name`
3. ì—°ì‚°ì: `==`
4. ê°’: `Hidden Type`
5. ì €ì¥
6. 3D ë·°ì–´ í™•ì¸

**ì˜ˆìƒ ê²°ê³¼**:
- âœ… "Hidden Type" íƒ€ì…ì˜ ëª¨ë“  ê°ì²´ê°€ ìˆ¨ê²¨ì§
- âœ… Type ì†ì„± ê¸°ë°˜ í•„í„°ë§ ì •ìƒ ë™ì‘

---

## êµ¬í˜„ ìƒíƒœ

### ì™„ë£Œ âœ…
1. Blender Addon - Type Attributes ìˆ˜ì§‘
   - `__init__.py` lines 394-438 ìˆ˜ì •
   - Type.Attributes ë”•ì…”ë„ˆë¦¬ ì¶”ê°€
   - Type.PropertySet êµ¬ì¡° ê°œì„ 

### ì§„í–‰ ì¤‘ ğŸ”„
- ì—†ìŒ (ì„¤ê³„ ë‹¨ê³„)

### TODO ğŸ“
1. í”„ë¡ íŠ¸ì—”ë“œ - Type ì†ì„± í‘œì‹œ
   - `ui.js`: `generateBIMPropertyOptions()` ìˆ˜ì •
   - `ui.js`: `getValueForItem()`, `getInternalFieldName()` ìˆ˜ì •
   - Helper Panel: Type ì„¹ì…˜ ì¶”ê°€

2. ì¡°ê±´ë¶€ ìˆ¨ê¹€ UI
   - `models.py`: `Project.visibility_filters` í•„ë“œ ì¶”ê°€
   - `revit_control.html`: ê°€ì‹œì„± í•„í„° ì„¹ì…˜ ì¶”ê°€
   - `data_management_handlers.js`: í•„í„° CRUD í•¨ìˆ˜ êµ¬í˜„
   - `three_d_viewer.js`: í•„í„° ì ìš© ë¡œì§ ì¶”ê°€

3. Revit Addin - Type Properties ìˆ˜ì§‘
   - `RevitDataCollector.cs`: ElementType ë°ì´í„° ìˆ˜ì§‘
   - Type Parameters ìˆ˜ì§‘
   - JSON êµ¬ì¡° ìƒì„±

4. í…ŒìŠ¤íŠ¸ ë° ë””ë²„ê¹…
   - Blenderë¡œ Type ì†ì„± í…ŒìŠ¤íŠ¸
   - ì¡°ê±´ë¶€ ìˆ¨ê¹€ í…ŒìŠ¤íŠ¸
   - Revitìœ¼ë¡œ Type ì†ì„± í…ŒìŠ¤íŠ¸

---

## í–¥í›„ ê°œì„  ì‚¬í•­

### 1. ê³ ê¸‰ í•„í„° ì¡°ê±´
- AND/OR ë…¼ë¦¬ ì—°ì‚°ì ì§€ì›
- ì¤‘ì²© ì¡°ê±´ ì§€ì›
- ì •ê·œì‹ íŒ¨í„´ ë§¤ì¹­

### 2. í•„í„° í”„ë¦¬ì…‹
- ìì£¼ ì‚¬ìš©í•˜ëŠ” í•„í„° ì¡°í•© ì €ì¥
- í”„ë¦¬ì…‹ ê³µìœ  ê¸°ëŠ¥
- í”„ë¦¬ì…‹ ê°€ì ¸ì˜¤ê¸°/ë‚´ë³´ë‚´ê¸°

### 3. ê°€ì‹œì„± ë ˆì´ì–´
- ì—¬ëŸ¬ í•„í„° ê·¸ë£¹ì„ ë ˆì´ì–´ë¡œ ê´€ë¦¬
- ë ˆì´ì–´ë³„ ON/OFF í† ê¸€
- ë ˆì´ì–´ ìš°ì„ ìˆœìœ„ ì„¤ì •

### 4. Type ì†ì„± ê²€ìƒ‰
- Type ê¸°ë°˜ ê°ì²´ ê²€ìƒ‰
- Type ì†ì„± ê¸°ë°˜ ë¶„ë¥˜
- Typeë³„ í†µê³„ í‘œì‹œ

### 5. ì„±ëŠ¥ ìµœì í™”
- í•„í„° í‰ê°€ ìºì‹±
- ëŒ€ìš©ëŸ‰ IFC íŒŒì¼ ìµœì í™”
- í•„í„° ì¸ë±ì‹±

---

## ê´€ë ¨ ë¬¸ì„œ

- IFC ìŠ¤í‚¤ë§ˆ: https://standards.buildingsmart.org/IFC/RELEASE/IFC4/ADD2_TC1/HTML/
- ifcopenshell ë¬¸ì„œ: https://ifcopenshell.org/
- Revit API: https://www.revitapidocs.com/

---

## ì»¤ë°‹ ë©”ì‹œì§€ (ì˜ˆì •)

```
Add IFC Type properties collection and conditional visibility (Part 1: Blender)

Features:
1. Type Attributes Collection (Blender Addon)
   - Extract Type.Attributes from IfcWallType, etc.
   - Include Type.PropertySet in flat structure
   - Naming: BIM.Type.Attributes.*, BIM.Type.PropertySet.*

2. Conditional Visibility (Design Only)
   - Design UI for visibility filters
   - Project-level filter settings (JSON)
   - Filter operators: ==, !=, contains, startsWith, endsWith
   - Apply filters on 3D viewer load

Changes:
1. CostEstimator_BlenderAddon_453/__init__.py
   - serialize_ifc_elements_to_string_list(): Add Type.Attributes extraction
   - Type info structure: Name, IfcClass, Attributes, PropertySet

TODO:
- Frontend: generateBIMPropertyOptions(), getValueForItem()
- UI: Visibility filter settings panel
- 3D Viewer: Apply filters on load
- Revit Addin: ElementType data collection

Test:
- Load IFC with IfcWall + IfcWallType
- Check Type.Attributes in Helper Panel
- Verify Type properties available in Field Selection

ğŸ¤– Generated with [Claude Code](https://claude.com/claude-code)

Co-Authored-By: Claude <noreply@anthropic.com>
```
