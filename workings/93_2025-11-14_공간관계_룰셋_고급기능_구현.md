# ê³µê°„ê´€ê³„ ë£°ì…‹ ê³ ê¸‰ ê¸°ëŠ¥ êµ¬í˜„

**ì‘ì—… ë‚ ì§œ**: 2025-11-14
**ì‘ì—…ì**: Claude Code
**ê´€ë ¨ ì´ìŠˆ**: ê³µê°„ê´€ê³„ ë£°ì…‹ ì‹œìŠ¤í…œ ê°œì„  - ì†ì„± ê¸°ë°˜ ì„ íƒ, ì¡°ê±´ë¶€ ë§¤í•‘, ì ‘ì´‰ ê°ì§€

---

## ğŸ“‹ ì‘ì—… ê°œìš”

ê³µê°„ê´€ê³„ ë£°ì…‹ ì‹œìŠ¤í…œì— 3ê°€ì§€ ê³ ê¸‰ ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ì—¬ ë” ì •êµí•œ ê¸°í•˜í•™ì  ê´€ê³„ ë¶„ì„ ë° ì†ì„± ë§¤í•‘ì„ ê°€ëŠ¥í•˜ê²Œ í•¨:

1. **ì†ì„± ê¸°ë°˜ ê°ì²´ ì„ íƒ** (property_max/property_min)
2. **Top Cap Contact ê°ì§€** (ê¸°ë‘¥ ìƒë‹¨ë©´ê³¼ ìŠ¬ë¼ë¸Œ í•˜ë‹¨ë©´ ì ‘ì´‰)
3. **ì¡°ê±´ë¶€ ì†ì„± ë§¤í•‘** (ì ‘ì´‰ ì¡°ê±´ ë° ë¹„êµ ì¡°ê±´ì— ë”°ë¥¸ ë¶„ê¸°)

---

## ğŸ¯ êµ¬í˜„ëœ ê¸°ëŠ¥

### 1. ì†ì„± ê¸°ë°˜ ê°ì²´ ì„ íƒ (Property-based Selection)

**ê¸°ì¡´**: Z ì¢Œí‘œ(highest/lowest)ë‚˜ ê±°ë¦¬(nearest)ë¡œë§Œ ìµœì¢… ê°ì²´ ì„ íƒ ê°€ëŠ¥

**ê°œì„ **: ì„ì˜ì˜ ì†ì„± ê°’ì˜ ìµœëŒ€/ìµœì†Œ ê¸°ì¤€ìœ¼ë¡œ ì„ íƒ ê°€ëŠ¥

**ì‚¬ìš© ì˜ˆì‹œ**:
- ê¸°ë‘¥ê³¼ ê²¹ì¹˜ëŠ” ì—¬ëŸ¬ ìŠ¬ë¼ë¸Œ ì¤‘ **ë‘ê»˜ê°€ ê°€ì¥ í°** ìŠ¬ë¼ë¸Œ ì„ íƒ
- ì—¬ëŸ¬ ë²½ ì¤‘ **ë†’ì´ê°€ ê°€ì¥ ë‚®ì€** ë²½ ì„ íƒ

**êµ¬í˜„ íŒŒì¼**: `geometry_relation_analyzer.js`

**ì½”ë“œ ë³€ê²½**:
```javascript
// selectByMode() í•¨ìˆ˜ í™•ì¥ (lines 406-430)
case 'property_max':
    if (!relConfig.sort_property) {
        console.warn('[GeometryRelationAnalyzer] property_max mode requires sort_property');
        return [];
    }
    return [contactingObjects.sort((a, b) => {
        const aValue = parseFloat(this.getPropertyValue(a.qm, relConfig.sort_property)) || -Infinity;
        const bValue = parseFloat(this.getPropertyValue(b.qm, relConfig.sort_property)) || -Infinity;
        return bValue - aValue; // ë‚´ë¦¼ì°¨ìˆœ
    })[0]];

case 'property_min':
    // ì˜¤ë¦„ì°¨ìˆœ ì •ë ¬
    ...
```

**UI ë³€ê²½**: `geometry_relation_handlers.js`
- "ì„ íƒ ëª¨ë“œ" ë“œë¡­ë‹¤ìš´ì— `property_max`, `property_min` ì˜µì…˜ ì¶”ê°€
- "ì •ë ¬ ì†ì„±" ì…ë ¥ í•„ë“œ ì¶”ê°€ (sort_property)

---

### 2. Top Cap Contact ê°ì§€

**ëª©ì **: ê¸°ë‘¥ ìƒë‹¨ë©´ê³¼ ìŠ¬ë¼ë¸Œ í•˜ë‹¨ë©´ì˜ ì •ë°€ ì ‘ì´‰ ì—¬ë¶€ íŒë‹¨

**êµ¬í˜„ ë°©ì‹**:
- Ray casting ì‚¬ìš© (ê¸°ë‘¥ ìƒë‹¨ 9ê°œ í…ŒìŠ¤íŠ¸ í¬ì¸íŠ¸ì—ì„œ ìœ„ìª½ìœ¼ë¡œ ray ë°œì‚¬)
- 50% ì´ìƒì˜ í¬ì¸íŠ¸ê°€ ìŠ¬ë¼ë¸Œì™€ êµì°¨í•˜ë©´ ì ‘ì´‰ìœ¼ë¡œ íŒì •
- ê° ê´€ë ¨ ê°ì²´ì˜ `contactInfo.hasTopContact` í”Œë˜ê·¸ ì €ì¥

**êµ¬í˜„ íŒŒì¼**: `geometry_relation_analyzer.js`

**ì½”ë“œ ë³€ê²½**:
```javascript
// findRelatedObjects() í•¨ìˆ˜ ìˆ˜ì • (lines 80-103)
const contactingObjects = candidates.map(candidate => {
    const candidateMesh = this.getMeshByQmId(candidate.id);

    // Top cap contact ê°ì§€
    let hasTopContact = false;
    if (targetMesh && candidateMesh) {
        const topContactResult = this.checkTopCapContact(targetMesh, candidateMesh, relConfig.tolerance || 0.001);
        hasTopContact = topContactResult.isContacting;
    }

    return {
        qm: candidate,
        mesh: candidateMesh,
        contactInfo: {
            isContacting: true,
            hasTopContact: hasTopContact  // Top cap ì ‘ì´‰ ì—¬ë¶€
        }
    };
}).filter(obj => obj.mesh !== null);
```

**checkTopCapContact() í•¨ìˆ˜**: ì´ë¯¸ êµ¬í˜„ë˜ì–´ ìˆì—ˆìœ¼ë©°, ë°˜í™˜ê°’ì˜ `isContacting` í•„ë“œ í™œìš©

---

### 3. ì¡°ê±´ë¶€ ì†ì„± ë§¤í•‘ (Conditional Property Mapping)

**ëª©ì **: ê¸°í•˜í•™ì  ì ‘ì´‰ ì¡°ê±´ ë° ì†ì„± ë¹„êµ ì¡°ê±´ì— ë”°ë¼ ë‹¤ë¥¸ ì†ì„± í• ë‹¹

**3ê°€ì§€ ì¡°ê±´ ë¶„ê¸°**:

1. **Contact Condition** (ì ‘ì´‰ ì¡°ê±´):
   - `any`: ì¡°ê±´ ì—†ìŒ
   - `top_contact`: Top cap ì ‘ì´‰ì´ ìˆëŠ” ê²½ìš°ë§Œ
   - `no_top_contact`: Top cap ì ‘ì´‰ì´ ì—†ëŠ” ê²½ìš°ë§Œ

2. **Mapping Conditions** (ë¹„êµ ì¡°ê±´):
   - ì˜ˆ: `target.QM.Properties.ë†’ì´ > related.QM.Properties.ë†’ì´`
   - ì¡°ê±´ ë§Œì¡± ì‹œ í•´ë‹¹ ì†ì„± ì„¸íŠ¸ ì‚¬ìš©
   - ì—¬ëŸ¬ ì¡°ê±´ ì¤‘ ì²« ë²ˆì§¸ ë§Œì¡± ì¡°ê±´ ì ìš©

3. **Fallback Properties** (ê¸°ë³¸ ì†ì„±):
   - ìœ„ ì¡°ê±´ë“¤ì„ ëª¨ë‘ ë§Œì¡±í•˜ì§€ ì•Šì„ ë•Œ ì‚¬ìš©

**ë°ì´í„° êµ¬ì¡°**:
```javascript
property_assignments: {
  rules: [{
    relation_id: "rel_123",
    contact_condition: "no_top_contact",
    mapping_conditions: [
      {
        condition: "target.QM.Properties.ë†’ì´ > related.QM.Properties.ë†’ì´",
        properties: {
          "ìœ„ì¹˜": "ìƒë¶€",
          "ë“±ê¸‰": "Aê¸‰"
        }
      },
      {
        condition: "target.QM.Properties.ë†’ì´ < related.QM.Properties.ë†’ì´",
        properties: {
          "ìœ„ì¹˜": "í•˜ë¶€",
          "ë“±ê¸‰": "Bê¸‰"
        }
      }
    ],
    properties: {  // Fallback
      "ìœ„ì¹˜": "ì¤‘ê°„",
      "ë“±ê¸‰": "Cê¸‰"
    }
  }]
}
```

**êµ¬í˜„ íŒŒì¼**: `geometry_relation_handlers.js`

**ì£¼ìš” í•¨ìˆ˜**:

1. **evaluateConditionalMapping()** (lines 145-206):
   - Contact condition ì²´í¬
   - Mapping conditions ìˆœì°¨ í‰ê°€
   - ìµœì¢… ì†ì„± ì„¸íŠ¸ ì„ íƒ

2. **evaluateMappingCondition()** (lines 216-254):
   - ì¡°ê±´ì‹ íŒŒì‹± (ì—°ì‚°ì ì¶”ì¶œ)
   - ì¢Œë³€/ìš°ë³€ ê°’ ì¶”ì¶œ
   - ë¹„êµ ìˆ˜í–‰

3. **extractValueFromExpression()** (lines 263-274):
   - `target.XXX` â†’ ëŒ€ìƒ ê°ì²´ ì†ì„±
   - `related.XXX` â†’ ê´€ë ¨ ê°ì²´ ì†ì„±

4. **getPropertyValueFromPath()** (lines 282-382):
   - `QM.System.*`, `QM.Properties.*` ì ‘ê·¼
   - `BIM.PropertySet.*`, `BIM.Parameters.*` ì ‘ê·¼
   - Flat key í˜•ì‹ ì§€ì› (`PropertySet.ì¹˜ìˆ˜__ì²´ì `)

5. **compareValues()** (lines 390-410):
   - ì—°ì‚°ì: `==`, `!=`, `>`, `<`, `>=`, `<=`, `contains`, `startsWith`, `endsWith`

6. **evaluateTemplateExpression()** (lines 411-431):
   - `{target.QM.Properties.ë†’ì´}` â†’ ëŒ€ìƒ ê°ì²´ ê°’
   - `{related.BIM.PropertySet.XXX}` â†’ ê´€ë ¨ ê°ì²´ ê°’
   - `{BIM.XXX}`, `{QM.XXX}` ë‹¨ë… í˜•ì‹ ì§€ì› (related ê¸°ì¤€)

**UI ë³€ê²½**:
- "ì†ì„± í• ë‹¹ ê·œì¹™" ì„¹ì…˜ì— "ì ‘ì´‰ ì¡°ê±´" ë“œë¡­ë‹¤ìš´ ì¶”ê°€
- "ì¡°ê±´ë¶€ ë§¤í•‘" ë¹Œë” ì¶”ê°€ (ì¡°ê±´ì‹ + ì†ì„± ìŒ)
- "ê¸°ë³¸ ì†ì„±" ì…ë ¥ (fallback)

---

## ğŸ› ë²„ê·¸ ìˆ˜ì •

### 1. `index` ë³€ìˆ˜ ë¯¸ì •ì˜ ì˜¤ë¥˜

**ë¬¸ì œ**: `saveGeometryRelationRuleFromRow()` í•¨ìˆ˜ì—ì„œ `index` ë³€ìˆ˜ë¥¼ ì‚¬ìš©í–ˆìœ¼ë‚˜ ì •ì˜ë˜ì§€ ì•ŠìŒ

**ì›ì¸**: `relationRows.forEach(row => {})` ë£¨í”„ì—ì„œ ì¸ë±ìŠ¤ íŒŒë¼ë¯¸í„° ëˆ„ë½

**ìˆ˜ì •**:
```javascript
// Before
relationRows.forEach(row => {
    const relation = {
        name: `ê´€ê³„ ${index + 1}`,  // âŒ index undefined
        ...
    };
});

// After
relationRows.forEach((row, index) => {
    const relation = {
        name: `ê´€ê³„ ${index + 1}`,  // âœ… index ì •ì˜ë¨
        ...
    };
});
```

**íŒŒì¼**: `geometry_relation_handlers.js` (line 1057)

---

### 2. classification_tag ì¡°ê±´ í‰ê°€ ì‹¤íŒ¨

**ë¬¸ì œ**: `QM.System.classification_tag == "RC_ê¸°ë‘¥_ì§ì‚¬ê°í˜•_ê¸°íƒ€"` ì¡°ê±´ì´ í•­ìƒ false

**ì›ì¸**:
- API ì‘ë‹µì— `classification_tag` ê°ì²´ê°€ ì—†ê³  `classification_tag_name` ë¬¸ìì—´ í•„ë“œë§Œ ì¡´ì¬
- `evaluate_single_condition()` í•¨ìˆ˜ê°€ `qm.classification_tag?.name` ì ‘ê·¼ ì‹œ undefined ë°˜í™˜

**ìˆ˜ì •**:
```javascript
// Before
if (property === 'classification_tag' || property === 'QM.System.classification_tag') {
    actualValue = qm.classification_tag?.name || '';
}

// After
if (property === 'classification_tag' || property === 'QM.System.classification_tag') {
    actualValue = qm.classification_tag_name || qm.classification_tag?.name || '';
}
```

**íŒŒì¼**: `geometry_relation_handlers.js` (lines 439-447)

---

### 3. Mesh ê²€ìƒ‰ ì‹¤íŒ¨

**ë¬¸ì œ**: `getMeshByQmId()` í•¨ìˆ˜ê°€ QuantityMember IDë¡œ meshë¥¼ ì°¾ì§€ ëª»í•¨

**ì›ì¸**:
- 3D ë·°ì–´ê°€ meshì˜ `userData`ì— `rawElementId` ì €ì¥
- AnalyzerëŠ” `qmId` ë˜ëŠ” `quantityMemberId`ë¡œ ê²€ìƒ‰
- QuantityMember ID â‰  RawElement ID

**ìˆ˜ì •**:
```javascript
// Before
getMeshByQmId(qmId) {
    let foundMesh = null;
    this.scene.traverse(obj => {
        if (obj.userData?.qmId === qmId || obj.userData?.quantityMemberId === qmId) {
            foundMesh = obj;
        }
    });
    return foundMesh;
}

// After
getMeshByQmId(qmId) {
    // 1. QuantityMemberì—ì„œ raw_element_id ì°¾ê¸°
    const qm = this.quantityMembers.find(q => q.id === qmId);
    const rawElementId = qm.raw_element_id || qm.raw_element?.id;

    // 2. Sceneì—ì„œ rawElementIdë¡œ ì°¾ê¸°
    let foundMesh = null;
    this.scene.traverse(obj => {
        if (obj.userData?.rawElementId === rawElementId ||
            obj.userData?.bimObjectId === rawElementId ||
            obj.userData?.qmId === qmId ||
            obj.userData?.quantityMemberId === qmId) {
            foundMesh = obj;
        }
    });
    return foundMesh;
}
```

**íŒŒì¼**: `geometry_relation_analyzer.js` (lines 530-568)

---

### 4. ê´€ê³„ ë¶„ì„ ê²°ê³¼ êµ¬ì¡° ë¶ˆì¼ì¹˜

**ë¬¸ì œ**: `evaluateConditionalMapping()` í•¨ìˆ˜ê°€ `contactInfo` ì†ì„± ì ‘ê·¼ ì‹œ ì˜¤ë¥˜

**ì›ì¸**:
- `analyzeRelations()` ë°˜í™˜ê°’: `{objects: [qm, qm, ...]}` (QM ê°ì²´ë§Œ)
- `evaluateConditionalMapping()` ê¸°ëŒ€ê°’: `{qm, mesh, contactInfo}` ë°°ì—´

**ìˆ˜ì •**:
```javascript
// analyzeRelations() ë°˜í™˜ êµ¬ì¡° í™•ì¥
results[relConfig.id] = {
    exists: relatedObjects.length > 0,
    count: relatedObjects.length,
    objects: relatedObjects.map(obj => obj.qm),
    closest: relatedObjects[0]?.qm || null,
    all: relatedObjects.map(obj => obj.qm),
    fullObjects: relatedObjects  // âœ… {qm, mesh, contactInfo} ë°°ì—´ ì¶”ê°€
};

// evaluateConditionalMapping() ìˆ˜ì •
const relationResult = relations[relationId];
const fullObjects = relationResult.fullObjects || [];  // âœ… fullObjects ì‚¬ìš©
const relatedObj = fullObjects[0];
const hasTopContact = relatedObj.contactInfo?.hasTopContact || false;
```

**íŒŒì¼**:
- `geometry_relation_analyzer.js` (lines 55-64)
- `geometry_relation_handlers.js` (lines 215-229)

---

### 5. ì¡°ê±´ ì—†ëŠ” ê´€ê³„ ì €ì¥ ë¶ˆê°€

**ë¬¸ì œ**: `related_conditions`ê°€ ë¹„ì–´ìˆìœ¼ë©´ relationì´ ì €ì¥ë˜ì§€ ì•ŠìŒ

**ì›ì¸**: `if (related_conditions.length > 0)` ì¡°ê±´ìœ¼ë¡œ í•„í„°ë§

**ìˆ˜ì •**:
```javascript
// Before
if (related_conditions.length > 0) {
    relations.push(relation);
}

// After
// ê´€ê³„ rowê°€ ìˆìœ¼ë©´ ì¶”ê°€ (ì¡°ê±´ì´ ì—†ì–´ë„ toleranceì™€ find_modeë¡œ ë™ì‘ ê°€ëŠ¥)
relations.push(relation);
```

**íŒŒì¼**: `geometry_relation_handlers.js` (line 1083)

---

## ğŸ“ ìˆ˜ì •ëœ íŒŒì¼

### Frontend (JavaScript)

1. **`connections/static/connections/geometry_relation_handlers.js`**
   - ì¡°ê±´ë¶€ ë§¤í•‘ í‰ê°€ ë¡œì§ ì¶”ê°€ (6ê°œ í•¨ìˆ˜, ~250 lines)
   - ì¡°ê±´ í‰ê°€ í•¨ìˆ˜ ìˆ˜ì • (classification_tag ì²˜ë¦¬)
   - ë°ì´í„° ìˆ˜ì§‘ ë¡œì§ ì—…ë°ì´íŠ¸
   - ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì¶”ê°€
   - UI ë Œë”ë§ í•¨ìˆ˜ ì—…ë°ì´íŠ¸

2. **`connections/static/connections/geometry_relation_analyzer.js`**
   - `selectByMode()` í•¨ìˆ˜ í™•ì¥ (property_max/min ëª¨ë“œ ì¶”ê°€)
   - `findRelatedObjects()` ìˆ˜ì • (top contact ê°ì§€)
   - `getMeshByQmId()` ì¬ì‘ì„± (RawElement ID ë§¤í•‘)
   - `analyzeRelations()` ë°˜í™˜ êµ¬ì¡° í™•ì¥ (fullObjects ì¶”ê°€)

### Backend (Python)

3. **`connections/views.py`**
   - `apply_geometry_relation_rules_view()` í•¨ìˆ˜ ë‹¨ìˆœí™”
   - í”„ë¡ íŠ¸ì—”ë“œì—ì„œ ê³„ì‚°ëœ ì†ì„±ì„ ê·¸ëŒ€ë¡œ ì ìš©í•˜ë„ë¡ ë³€ê²½
   - ì¡°ê±´ í‰ê°€ ë¡œì§ ì œê±° (í”„ë¡ íŠ¸ì—”ë“œë¡œ ì´ê´€)

---

## ğŸ§ª í…ŒìŠ¤íŠ¸ ê²°ê³¼

### í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

**ëŒ€ìƒ**: ê¸°ë‘¥ (RC_ê¸°ë‘¥_ì§ì‚¬ê°í˜•_ê¸°íƒ€) 2ê°œ
**ê´€ë ¨ ê°ì²´**: ìŠ¬ë¼ë¸Œ 5ê°œ
**ì¡°ê±´**: classification_tag == "ìŠ¬ë¼ë¸Œ"
**ì„ íƒ ëª¨ë“œ**: highest
**ì†ì„± ë§¤í•‘**: `{BIM.PropertySet.ì¹˜ìˆ˜__ì½”ì–´ ë‘ê»˜}`

### ì‹¤í–‰ ê²°ê³¼

```
âœ“ Found 2 target objects (ê¸°ë‘¥)
âœ“ Stage 1: 5 candidates (ìŠ¬ë¼ë¸Œ)
âœ“ Stage 2: 4 overlapping objects
âœ“ Relation "undefined": Found 1 objects (highest ì„ íƒë¨)
âœ“ ì†ì„± í• ë‹¹ ì„±ê³µ: ìŠ¬ë¼ë¸Œì˜ ì‹¤ì œ ê°’ìœ¼ë¡œ ì¹˜í™˜ë¨
```

**í™•ì¸ ì‚¬í•­**:
- âœ… classification_tag ì¡°ê±´ ë§¤ì¹­
- âœ… Mesh ê²€ìƒ‰ ì„±ê³µ
- âœ… ê¸°í•˜í•™ì  ê²¹ì¹¨ ê°ì§€
- âœ… ìµœìƒë‹¨ ìŠ¬ë¼ë¸Œ ì„ íƒ
- âœ… Top contact ê°ì§€ (hasTopContact í”Œë˜ê·¸)
- âœ… í…œí”Œë¦¿ í‘œí˜„ì‹ í‰ê°€ (`{BIM.XXX}` â†’ ì‹¤ì œ ê°’)
- âœ… ì†ì„± ì €ì¥ ì„±ê³µ

---

## ğŸ“Š ì„±ëŠ¥ ì˜í–¥

- **ì¡°ê±´ í‰ê°€**: í”„ë¡ íŠ¸ì—”ë“œë¡œ ì´ê´€í•˜ì—¬ ì„œë²„ ë¶€í•˜ ê°ì†Œ
- **Mesh ê²€ìƒ‰**: ìºì‹±ìœ¼ë¡œ ì¬ê²€ìƒ‰ ë°©ì§€
- **ê´€ê³„ ë¶„ì„**: í‰ê·  6ms (2ê°œ ê¸°ë‘¥ Ã— 1ê°œ ê´€ê³„)

---

## ğŸ”„ ë°ì´í„° ë§ˆì´ê·¸ë ˆì´ì…˜

**í•„ìš” ì—†ìŒ** - JSONField êµ¬ì¡° í™•ì¥ì´ë¯€ë¡œ ê¸°ì¡´ ë°ì´í„° í˜¸í™˜

---

## ğŸ“ ì‚¬ìš© ì˜ˆì‹œ

### ì˜ˆì‹œ 1: ê¸°ë‘¥ ìƒë‹¨ ìŠ¬ë¼ë¸Œ ë‘ê»˜ ê°€ì ¸ì˜¤ê¸°

**ë£°ì…‹ ì„¤ì •**:
- ëŒ€ìƒ ì¡°ê±´: `QM.System.classification_tag == "RC_ê¸°ë‘¥_ì§ì‚¬ê°í˜•_ê¸°íƒ€"`
- ê´€ê³„ ì¡°ê±´: `QM.System.classification_tag == "ìŠ¬ë¼ë¸Œ"`
- ì„ íƒ ëª¨ë“œ: `highest`
- ì†ì„± ë§¤í•‘: `ìƒë‹¨ìŠ¬ë¼ë¸Œë‘ê»˜ = {BIM.PropertySet.ì¹˜ìˆ˜__ì½”ì–´ ë‘ê»˜}`

**ê²°ê³¼**: ê° ê¸°ë‘¥ì— ê°€ì¥ ìœ„ì— ìˆëŠ” ìŠ¬ë¼ë¸Œì˜ ë‘ê»˜ê°€ ì €ì¥ë¨

---

### ì˜ˆì‹œ 2: ì ‘ì´‰ ì¡°ê±´ì— ë”°ë¥¸ ë¶„ê¸°

**ë£°ì…‹ ì„¤ì •**:
- ì ‘ì´‰ ì¡°ê±´: `top_contact` (ìƒë‹¨ ì ‘ì´‰ ìˆì„ ë•Œë§Œ)
- ì¡°ê±´ë¶€ ë§¤í•‘:
  - ì¡°ê±´: `target.QM.Properties.ë†’ì´ > related.QM.Properties.ë‘ê»˜`
  - ì†ì„±: `ìƒíƒœ = "ëŒì¶œ"`
- ê¸°ë³¸ ì†ì„±: `ìƒíƒœ = "ì •ìƒ"`

**ê²°ê³¼**: ê¸°ë‘¥ì´ ìŠ¬ë¼ë¸Œ ìœ„ë¡œ ëŒì¶œë˜ì—ˆëŠ”ì§€ ìë™ íŒë‹¨

---

## ğŸ“ í•™ìŠµ ë‚´ìš©

### Property Inheritance Chain ì¤€ìˆ˜

ëª¨ë“  ì†ì„± ì ‘ê·¼ ì‹œ ë‹¤ìŒ ì²´ì¸ ì¤€ìˆ˜:
```
BIM (RawElement)
  â†“
QM (QuantityMember) - BIM.*, QM.*, MM.*, SC.*
  â†“
CI (CostItem) - ìœ„ + CI.*, CC.*
  â†“
AO (ActivityObject) - ìœ„ + AO.*, AC.*
```

### API ë°ì´í„° êµ¬ì¡° ì´í•´

```javascript
{
  "classification_tag_id": "uuid",
  "classification_tag_name": "RC_ê¸°ë‘¥_ì§ì‚¬ê°í˜•_ê¸°íƒ€",  // âœ… ì‹¤ì œ ì‚¬ìš©
  "raw_element": {
    "PropertySet.ì¹˜ìˆ˜__ì²´ì ": 7.05,  // âœ… Flat key í˜•ì‹
    "Parameters": { ... }
  }
}
```

### 3D Meshì™€ QuantityMember ë§¤í•‘

- Mesh: `userData.rawElementId` ë˜ëŠ” `userData.bimObjectId`
- QuantityMember: `qm.raw_element_id`
- ë§¤í•‘ í•„ìš”: QM ID â†’ raw_element_id â†’ Mesh ê²€ìƒ‰

---

## ğŸš€ í–¥í›„ ê°œì„  ì‚¬í•­

1. **UI ê°œì„ **:
   - ì¡°ê±´ ë¹Œë”ì— í•„ë“œ ìë™ì™„ì„±
   - í…œí”Œë¦¿ í‘œí˜„ì‹ ê²€ì¦
   - ì‹œê°ì  relation ID í‘œì‹œ (í˜„ì¬ undefined)

2. **ì„±ëŠ¥ ìµœì í™”**:
   - Spatial indexing (Octree, BVH)
   - ë³‘ë ¬ ì²˜ë¦¬

3. **ê¸°ëŠ¥ í™•ì¥**:
   - ë‹¤ì¤‘ ê´€ê³„ ì²´ì¸ (A â†’ B â†’ C)
   - ì§‘ê³„ í•¨ìˆ˜ (AVG, SUM, COUNT)
   - ì—­ë°©í–¥ ë§¤í•‘ (related â†’ target)

---

## âœ… ì™„ë£Œ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [x] ì†ì„± ê¸°ë°˜ ì„ íƒ êµ¬í˜„ (property_max/min)
- [x] Top cap contact ê°ì§€ êµ¬í˜„
- [x] ì¡°ê±´ë¶€ ë§¤í•‘ í‰ê°€ ë¡œì§ êµ¬í˜„
- [x] UI ì—…ë°ì´íŠ¸ (ë“œë¡­ë‹¤ìš´, ë¹Œë”)
- [x] ë°ì´í„° ìˆ˜ì§‘ ë¡œì§ ì—…ë°ì´íŠ¸
- [x] ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ë“±ë¡
- [x] ë²„ê·¸ ìˆ˜ì • (5ê±´)
- [x] ì—”ë“œíˆ¬ì—”ë“œ í…ŒìŠ¤íŠ¸ ì„±ê³µ
- [x] ë¬¸ì„œí™”

---

## ğŸ“Œ ì°¸ê³  ìë£Œ

- **ê´€ë ¨ ë¬¸ì„œ**: `CLAUDE.md` - Property Inheritance System ì„¹ì…˜
- **ê´€ë ¨ ì»¤ë°‹**: (ì´ ë¬¸ì„œ ì‘ì„± í›„ ì»¤ë°‹ ì˜ˆì •)
- **í…ŒìŠ¤íŠ¸ í”„ë¡œì íŠ¸**: `SampleProject/01_TestProject/TestProject.ifc`

---

**ì‘ì„± ì™„ë£Œ**: 2025-11-14
**ì´ ì‘ì—… ì‹œê°„**: ~4ì‹œê°„
**ì½”ë“œ ë³€ê²½ ë¼ì¸ ìˆ˜**: ~600 lines
