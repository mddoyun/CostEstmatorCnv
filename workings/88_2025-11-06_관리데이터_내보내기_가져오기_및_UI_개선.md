# 2025-11-06: ê´€ë¦¬ ë°ì´í„° ë‚´ë³´ë‚´ê¸°/ê°€ì ¸ì˜¤ê¸° ê¸°ëŠ¥ êµ¬í˜„ ë° UI ê°œì„ 

## ì‘ì—… ê°œìš”
í”„ë¡œì íŠ¸ì˜ ê´€ë¦¬ ë°ì´í„°(ë£°ì…‹, ì½”ë“œ, ì„¤ì • ë“±)ë§Œ ë³„ë„ë¡œ ë‚´ë³´ë‚´ê³  ê°€ì ¸ì˜¬ ìˆ˜ ìˆëŠ” ê¸°ëŠ¥ì„ êµ¬í˜„í–ˆìŠµë‹ˆë‹¤. BIM ë°ì´í„°ë¥¼ ì œì™¸í•˜ê³  ìˆœìˆ˜ ì„¤ì •ë§Œ ì €ì¥/ë¶ˆëŸ¬ì˜¤ê¸°ê°€ ê°€ëŠ¥í•˜ë„ë¡ ê°œì„ í–ˆìŠµë‹ˆë‹¤.

## ì£¼ìš” ë³€ê²½ì‚¬í•­

### 1. ê´€ë¦¬ ë°ì´í„° ë‚´ë³´ë‚´ê¸°/ê°€ì ¸ì˜¤ê¸° API êµ¬í˜„

#### Backend (connections/views.py)
- **export_management_data()** (lines 4085-4172)
  - BIM ë°ì´í„° ì œì™¸, ê´€ë¦¬ ë°ì´í„°ë§Œ JSONìœ¼ë¡œ ë‚´ë³´ë‚´ê¸°
  - í¬í•¨ ë°ì´í„°: QuantityClassificationTag, CostCode, MemberMark, UnitPriceType, UnitPrice, AIModel, SpaceClassification, ëª¨ë“  ë£°ì…‹, Activity, ActivityDependency, WorkCalendar
  - ì œì™¸ ë°ì´í„°: RawElement, SplitElement, ElementClassificationAssignment, QuantityMember, CostItem, ActivityObject

- **import_management_data()** (lines 4177-4474)
  - ê¸°ì¡´ í”„ë¡œì íŠ¸ì˜ ê´€ë¦¬ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ê³  ìƒˆ ë°ì´í„°ë¡œ ëŒ€ì²´
  - FK ê´€ê³„ ë° M2M í•„ë“œ ì˜¬ë°”ë¥¸ ì²˜ë¦¬
  - SpaceClassificationì˜ source_elementëŠ” null ì²˜ë¦¬ (BIM ë°ì´í„° ì°¸ì¡°)

#### URL Routing (connections/urls.py)
```python
# lines 125-126
path('export-management-data/<uuid:project_id>/', views.export_management_data, name='export_management_data'),
path('import-management-data/<uuid:project_id>/', views.import_management_data, name='import_management_data'),
```

### 2. UI êµ¬ì„±ìš”ì†Œ ì¶”ê°€

#### HTML Template (connections/templates/revit_control.html)
- ê´€ë¦¬ íƒ­ secondary nav ë§¨ ì˜¤ë¥¸ìª½ì— ë²„íŠ¼ ì¶”ê°€ (lines 173-179)
- AI ëª¨ë¸ ê´€ë¦¬ íƒ­ ë’¤ì— ìœ„ì¹˜
- `sub-nav-button` í´ë˜ìŠ¤ ì‚¬ìš©í•˜ì—¬ íƒ­ ë†’ì´ì— ë§ì¶¤
- `margin-left: auto`ë¡œ ì˜¤ë¥¸ìª½ ì •ë ¬

```html
<button id="export-management-data-btn" class="sub-nav-button" style="background: #007bff; color: white; margin-left: auto;" disabled>
    ğŸ“¤ ìì‚° ë‚´ë³´ë‚´ê¸°
</button>
<button id="import-management-data-btn" class="sub-nav-button" style="background: #28a745; color: white;" disabled>
    ğŸ“¥ ìì‚° ê°€ì ¸ì˜¤ê¸°
</button>
<input type="file" id="management-data-file-input" accept=".json" style="display: none;">
```

### 3. JavaScript í•¸ë“¤ëŸ¬ êµ¬í˜„

#### project_management_handlers.js
- **enableManagementDataButtons()** (lines 304-317)
  - í”„ë¡œì íŠ¸ ì„ íƒ ì—¬ë¶€ì— ë”°ë¼ ë²„íŠ¼ í™œì„±í™”/ë¹„í™œì„±í™”

- **handleExportManagementData()** (lines 322-381)
  - Content-Disposition í—¤ë”ì—ì„œ íŒŒì¼ëª… ì¶”ì¶œ
  - allProjects ë³€ìˆ˜ ì˜ì¡´ì„± ì œê±° (ì—ëŸ¬ ìˆ˜ì •)
  - íƒ€ì„ìŠ¤íƒ¬í”„ ê¸°ë°˜ íŒŒì¼ëª… fallback

- **handleImportManagementData()** (lines 387-488)
  - í™•ì¸ ëŒ€í™”ìƒìë¡œ ì‚¬ìš©ì í™•ì¸
  - í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì œê±°
  - ëª¨ë“  ê´€ë¦¬ ë°ì´í„° ì¦‰ì‹œ ë¦¬ë¡œë“œ:
    - WebSocketìœ¼ë¡œ íƒœê·¸ ìš”ì²­
    - loadCostCodes(), loadMemberMarks(), loadSpaceClassifications()
    - loadUnitPriceTypes(), loadActivities()
    - í™œì„±í™”ëœ ë£°ì…‹ ë¦¬ë¡œë“œ
    - í˜„ì¬ íƒ­ UI ì—…ë°ì´íŠ¸

#### Event Listener ì„¤ì •
- **app.js**: setupManagementDataListeners() (lines 3-22)
- **app_core.js**: ì´ˆê¸°í™” ì‹œ í˜¸ì¶œ (line 166)
- **home_tab_handlers.js**: í”„ë¡œì íŠ¸ ì„ íƒ ì‹œ ë²„íŠ¼ í™œì„±í™” (lines 156-158)

### 4. í”„ë¡œì íŠ¸ ì „í™˜ ì‹œ 3D ë·°í¬íŠ¸ ìë™ ì´ˆê¸°í™”

#### project_management_handlers.js
```javascript
// lines 16-20
// 3D ë·°í¬íŠ¸ ì´ˆê¸°í™” (ì¥ë©´ í´ë¦¬ì–´)
if (typeof window.clearScene === 'function') {
    console.log('[DEBUG][handleProjectChange] Clearing 3D viewport scene...');
    window.clearScene();
}
```

- í”„ë¡œì íŠ¸ ì „í™˜ ì‹œ ìë™ìœ¼ë¡œ 3D ë·°í¬íŠ¸ ì´ˆê¸°í™”
- "ì´ˆê¸°í™”" ë²„íŠ¼ ëˆ„ë¥¸ ê²ƒê³¼ ë™ì¼í•œ íš¨ê³¼

### 5. í”„ë¡œì íŠ¸ ì´ë¦„ ë³€ê²½ ê¸°ëŠ¥

#### Backend
- **rename_project()** (views.py lines 139-197)
  - ì¤‘ë³µ ì´ë¦„ í™•ì¸
  - í”„ë¡œì íŠ¸ ì´ë¦„ ì—…ë°ì´íŠ¸

#### Frontend
- **handleHomeRenameProject()** (home_tab_handlers.js lines 462-519)
- í™ˆ íƒ­ í”„ë¡œì íŠ¸ ê´€ë¦¬ ì„¹ì…˜ì— ë²„íŠ¼ ì¶”ê°€
- ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ ì„¤ì •

## íŒŒì¼ ë³€ê²½ ëª©ë¡

### Backend
- `connections/views.py` - export_management_data(), import_management_data(), rename_project() ì¶”ê°€
- `connections/urls.py` - ê´€ë¦¬ ë°ì´í„° ë° ì´ë¦„ ë³€ê²½ URL ë¼ìš°íŒ… ì¶”ê°€

### Frontend - JavaScript
- `connections/static/connections/project_management_handlers.js`
  - ê´€ë¦¬ ë°ì´í„° í•¸ë“¤ëŸ¬ ì¶”ê°€
  - allProjects ì˜ì¡´ì„± ì œê±°
  - 3D ë·°í¬íŠ¸ ìë™ ì´ˆê¸°í™”
  - í”„ë¡œì íŠ¸ ì´ë¦„ ë³€ê²½ í•¸ë“¤ëŸ¬

- `connections/static/connections/app.js`
  - setupManagementDataListeners() ì¶”ê°€

- `connections/static/connections/app_core.js`
  - ê´€ë¦¬ ë°ì´í„° ë¦¬ìŠ¤ë„ˆ ì´ˆê¸°í™” í˜¸ì¶œ

- `connections/static/connections/home_tab_handlers.js`
  - í”„ë¡œì íŠ¸ ì„ íƒ ì‹œ ê´€ë¦¬ ë°ì´í„° ë²„íŠ¼ í™œì„±í™”
  - ì´ë¦„ ë³€ê²½ í•¸ë“¤ëŸ¬ ì¶”ê°€

### Frontend - HTML
- `connections/templates/revit_control.html`
  - ê´€ë¦¬ íƒ­ì— ìì‚° ë‚´ë³´ë‚´ê¸°/ê°€ì ¸ì˜¤ê¸° ë²„íŠ¼ ì¶”ê°€
  - í™ˆ íƒ­ì— í”„ë¡œì íŠ¸ ì´ë¦„ ë³€ê²½ ë²„íŠ¼ ì¶”ê°€

## ì£¼ìš” ê¸°ëŠ¥

### ìì‚° ë‚´ë³´ë‚´ê¸°
1. í”„ë¡œì íŠ¸ ì„ íƒ í›„ "ğŸ“¤ ìì‚° ë‚´ë³´ë‚´ê¸°" ë²„íŠ¼ í´ë¦­
2. JSON íŒŒì¼ ìë™ ë‹¤ìš´ë¡œë“œ (íŒŒì¼ëª…: ì„œë²„ì—ì„œ ì œê³µ ë˜ëŠ” íƒ€ì„ìŠ¤íƒ¬í”„)
3. BIM ë°ì´í„° ì œì™¸, ìˆœìˆ˜ ê´€ë¦¬ ë°ì´í„°ë§Œ í¬í•¨

### ìì‚° ê°€ì ¸ì˜¤ê¸°
1. í”„ë¡œì íŠ¸ ì„ íƒ í›„ "ğŸ“¥ ìì‚° ê°€ì ¸ì˜¤ê¸°" ë²„íŠ¼ í´ë¦­
2. JSON íŒŒì¼ ì„ íƒ
3. í™•ì¸ ëŒ€í™”ìƒìë¡œ ë®ì–´ì“°ê¸° í™•ì¸
4. ê¸°ì¡´ ê´€ë¦¬ ë°ì´í„° ì‚­ì œ í›„ ìƒˆ ë°ì´í„° ì ìš©
5. **í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì—†ì´** ëª¨ë“  ê´€ë¦¬ íƒ­ ì¦‰ì‹œ ì—…ë°ì´íŠ¸

### í”„ë¡œì íŠ¸ ì „í™˜ ê°œì„ 
- í”„ë¡œì íŠ¸ ë³€ê²½ ì‹œ 3D ë·°í¬íŠ¸ ìë™ ì´ˆê¸°í™”
- ì´ì „ í”„ë¡œì íŠ¸ì˜ 3D ê°ì²´ ìë™ ì œê±°

## ë²„ê·¸ ìˆ˜ì •

### allProjects ì°¸ì¡° ì—ëŸ¬
- **ë¬¸ì œ**: `allProjects` ë³€ìˆ˜ê°€ ì •ì˜ë˜ì§€ ì•Šì•„ ë‚´ë³´ë‚´ê¸° ì‹¤íŒ¨
- **í•´ê²°**: Content-Disposition í—¤ë”ì—ì„œ íŒŒì¼ëª… ì¶”ì¶œí•˜ë„ë¡ ë³€ê²½
- **ìœ„ì¹˜**: project_management_handlers.js lines 348-362

### ìì‚° ê°€ì ¸ì˜¤ê¸° í›„ ì—…ë°ì´íŠ¸ ëˆ„ë½
- **ë¬¸ì œ**: ìì‚° ê°€ì ¸ì˜¤ê¸° í›„ ì¼ë¶€ íƒ­ì´ ì¦‰ì‹œ ì—…ë°ì´íŠ¸ë˜ì§€ ì•ŠìŒ
- **í•´ê²°**: ëª¨ë“  ê´€ë¦¬ ë°ì´í„° ë¡œë“œ í•¨ìˆ˜ ëª…ì‹œì  í˜¸ì¶œ
- **ìœ„ì¹˜**: project_management_handlers.js lines 434-481

## í…ŒìŠ¤íŠ¸ ì‹œë‚˜ë¦¬ì˜¤

1. âœ… í”„ë¡œì íŠ¸ Aì—ì„œ ìì‚° ë‚´ë³´ë‚´ê¸°
2. âœ… í”„ë¡œì íŠ¸ Bì—ì„œ ìì‚° ê°€ì ¸ì˜¤ê¸°
3. âœ… ëª¨ë“  ê´€ë¦¬ íƒ­(ìˆ˜ëŸ‰ì‚°ì¶œë¶„ë¥˜, ê³µì‚¬ì½”ë“œ, ì¼ëŒë¶€í˜¸, ê³µê°„ë¶„ë¥˜, ë£°ì…‹ ë“±) ì¦‰ì‹œ ì—…ë°ì´íŠ¸ í™•ì¸
4. âœ… BIM ë°ì´í„°(RawElement, QuantityMember, CostItem ë“±) ì˜í–¥ ì—†ìŒ í™•ì¸
5. âœ… í”„ë¡œì íŠ¸ ì „í™˜ ì‹œ 3D ë·°í¬íŠ¸ ìë™ ì´ˆê¸°í™” í™•ì¸
6. âœ… í˜ì´ì§€ ìƒˆë¡œê³ ì¹¨ ì—†ì´ ë™ì‘ í™•ì¸

## ì°¸ê³ ì‚¬í•­

- ìì‚° ê°€ì ¸ì˜¤ê¸°ëŠ” í˜„ì¬ í”„ë¡œì íŠ¸ì˜ **ëª¨ë“  ê´€ë¦¬ ë°ì´í„°ë¥¼ ì‚­ì œí•˜ê³  ëŒ€ì²´**í•©ë‹ˆë‹¤
- BIM ë°ì´í„°(ê°ì²´, ìˆ˜ëŸ‰ë¶€ì¬, ì‚°ì¶œí•­ëª© ë“±)ëŠ” ì˜í–¥ë°›ì§€ ì•ŠìŠµë‹ˆë‹¤
- í”„ë¡œì íŠ¸ ê°„ ì„¤ì • í…œí”Œë¦¿ ê³µìœ  ì‹œ ìœ ìš©í•©ë‹ˆë‹¤
- 500ms ì§€ì—° í›„ ë°ì´í„° ë¦¬ë¡œë“œí•˜ì—¬ ì„œë²„ ì‘ë‹µ ëŒ€ê¸°
