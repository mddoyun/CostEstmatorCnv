## 2025-10-27 main.js BOQ 기능 리팩토링 요약

### 대화 및 작업 내용

사용자의 요청에 따라 `main.js` 파일의 크기를 줄이고 모듈화를 진행하기 위한 리팩토링 작업을 시작했습니다. 첫 번째 단계로 BOQ(Bill of Quantities) 관련 기능을 별도의 파일로 분리했습니다.

1.  **`GEMINI.md` 업데이트:** 프론트엔드 코드가 더 이상 단일 `main.js` 파일이 아닌 여러 모듈로 구성되어 있음을 반영하도록 `GEMINI.md` 파일의 개발 규칙 섹션을 한글로 수정하고 내용을 업데이트했습니다.

2.  **`boq_detailed_estimation_handlers.js` 파일 생성:**
    *   `/Users/mddoyun/Developments/CostEstimatorCnv/connections/static/connections/boq_detailed_estimation_handlers.js` 경로에 새 JavaScript 파일을 생성했습니다.
    *   `main.js`에 있던 모든 BOQ 관련 전역 변수(`availableBoqFields`, `loadedDdCostItems`, `loadedUnitPriceTypesForBoq`, `boqColumnAliases`, `currentBoqColumns`, `boqFilteredRawElementIds`, `currentBoqDetailItemId`) 및 함수들(`setupDetailedEstimationListeners`, `loadBoqGroupingFields`, `addBoqGroupingLevel`, `generateBoqReport`, `setupBoqTableInteractions`, `handleBoqSelectInClientFromDetail`, `updateBoqDetailsPanel`, `renderBoqItemProperties`, `initializeBoqUI`, `handleBoqSelectInClient`, `handleBoqGetFromClient`, `handleBoqClearFilter`, `resetBoqColumnsAndRegenerate`, `updateDdBoqColumns`, `saveBoqColumnSettings`, `loadBoqColumnSettings`, `renderBoqBimObjectCostSummary`, `renderBoqDisplayFieldControls`, `renderBoqTable`)을 이 새 파일로 이동했습니다.

3.  **`main.js` 수정:**
    *   `main.js`에서 위에서 언급된 BOQ 관련 전역 변수 초기화 및 함수 정의를 모두 제거했습니다.
    *   `main.js` 상단에 `/* global ... */` 주석 블록을 추가하여 새 파일로 이동된 함수 및 변수들이 전역 스코프에서 사용될 수 있음을 명시했습니다.

4.  **`revit_control.html` 업데이트:**
    *   `revit_control.html` 파일에 `<script src="{% static 'connections/boq_detailed_estimation_handlers.js' %}"></script>` 태그를 `main.js` 스크립트 태그보다 먼저 로드되도록 추가하여 BOQ 관련 기능이 `main.js`에서 사용되기 전에 정의되도록 했습니다.

5.  **`app_core.js` 수정:**
    *   `app_core.js`에서 BOQ 관련 전역 변수 초기화(`window.boqFilteredRawElementIds` 등) 및 `loadBoqColumnSettings()` 호출을 제거했습니다. 이는 해당 변수와 함수가 이제 `boq_detailed_estimation_handlers.js`에서 관리되기 때문입니다.
    *   `app_core.js`의 `DOMContentLoaded` 리스너 내에서 `setupDetailedEstimationListeners()` 함수를 호출하는 부분은 그대로 유지했습니다. 이 함수는 이제 `boq_detailed_estimation_handlers.js`에 정의된 함수를 참조합니다.

### 발생한 문제 및 해결

*   **`RangeError: Maximum call stack size exceeded` 오류:** 초기 리팩토링 과정에서 `main.js`에 `setupDetailedEstimationListeners` 함수를 재귀적으로 호출하는 플레이스홀더 코드가 남아있어 `RangeError`가 발생했습니다. 이 문제는 `main.js`에서 해당 플레이스홀더 함수 정의를 완전히 제거함으로써 해결되었습니다.

### 현재 상태

BOQ 관련 기능은 `boq_detailed_estimation_handlers.js`로 성공적으로 분리되었으며, 애플리케이션은 현재 정상적으로 작동하는 것으로 확인되었습니다. `main.js` 파일의 크기가 크게 줄어들었으며, 코드의 모듈성이 향상되었습니다.
