# 2025-11-04: DD 탭 리사이즈 스플릿바 및 접기/펼치기 기능 구현 계획

## 요구사항

### 1. 좌측-중간 영역 사이
- 드래그 가능한 스플릿바 추가
- 마우스로 영역 크기 조정 가능

### 2. 중간-우측 영역 사이
- 드래그 가능한 스플릿바 추가
- 마우스로 영역 크기 조정 가능

### 3. 좌측 패널
- 최소 폭 설정 (예: 250px)
- 접기/펼치기 토글 버튼
- 접혔을 때 완전히 숨김

### 4. 우측 패널
- 최소 폭 설정 (예: 250px)
- 접기/펼치기 토글 버튼
- 접혔을 때 완전히 숨김

### 5. 3D 뷰포트
- 왼쪽으로 접기/펼치기 버튼
- 접혔을 때 슬라이드 애니메이션

## 현재 구조

### HTML 구조 (revit_control.html)
```html
<div id="detailed-estimation-dd" class="tab-content">
    <div class="boq-container">
        <!-- 좌측 패널 토글 버튼 (기존) -->
        <button id="boq-left-panel-toggle-btn">◀</button>

        <!-- 좌측 패널 -->
        <aside class="boq-left-panel">
            ...
        </aside>

        <!-- 중간 영역 -->
        <main class="boq-main-content">
            ...
        </main>

        <!-- 우측 패널 -->
        <aside class="boq-bim-object-summary-panel">
            ...
        </aside>
    </div>
</div>
```

### CSS (style.css)
- `.boq-container`: flex-direction: row, gap: 20px
- `.boq-left-panel`: width: 320px, flex-shrink: 0
- `.boq-main-content`: flex-grow: 1
- `.boq-bim-object-summary-panel`: flex: 1

## 구현 계획

### 1. HTML 수정 (revit_control.html)

#### 1.1 스플릿바 추가
```html
<div class="boq-container">
    <button id="boq-left-panel-toggle-btn">◀</button>

    <aside class="boq-left-panel">...</aside>

    <!-- 좌측-중간 스플릿바 -->
    <div class="boq-split-bar" data-target="left"></div>

    <main class="boq-main-content">...</main>

    <!-- 중간-우측 스플릿바 -->
    <div class="boq-split-bar" data-target="right"></div>

    <aside class="boq-bim-object-summary-panel">...</aside>

    <!-- 우측 패널 토글 버튼 -->
    <button id="boq-right-panel-toggle-btn">▶</button>
</div>
```

#### 1.2 3D 뷰포트 토글 버튼
```html
<div id="three-d-viewer" class="tab-content">
    <button id="viewer-toggle-btn" class="viewer-toggle-btn">◀ 숨기기</button>
    ...
</div>
```

### 2. CSS 수정 (style.css)

#### 2.1 스플릿바 스타일
```css
.boq-split-bar {
    width: 4px;
    background: var(--border-color);
    cursor: col-resize;
    position: relative;
    transition: background 0.2s;
}

.boq-split-bar:hover {
    background: var(--primary-color);
}

.boq-split-bar::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    width: 16px;
    height: 40px;
    border-radius: 4px;
    background: rgba(0,0,0,0.1);
}
```

#### 2.2 패널 폭 조정
```css
.boq-left-panel {
    width: 320px;
    min-width: 250px;
    max-width: 600px;
    flex-shrink: 0;
}

.boq-bim-object-summary-panel {
    width: 320px;
    min-width: 250px;
    max-width: 600px;
    flex-shrink: 0;
}

.boq-container.left-panel-collapsed .boq-left-panel {
    width: 0 !important;
    min-width: 0 !important;
    overflow: hidden;
}

.boq-container.right-panel-collapsed .boq-bim-object-summary-panel {
    width: 0 !important;
    min-width: 0 !important;
    overflow: hidden;
}
```

#### 2.3 우측 토글 버튼
```css
#boq-right-panel-toggle-btn {
    position: absolute;
    top: 50%;
    right: 2px;
    transform: translateY(-50%);
    z-index: 10;
    background: var(--background-color);
    border: 1px solid var(--border-color);
    border-radius: 4px 0 0 4px;
    padding: 10px 5px;
    cursor: pointer;
    transition: all 0.3s ease;
}

.boq-container.right-panel-collapsed #boq-right-panel-toggle-btn {
    transform: translateY(-50%) rotate(180deg);
}
```

#### 2.4 3D 뷰포트 토글
```css
#viewer-toggle-btn {
    position: fixed;
    top: 50%;
    right: 10px;
    transform: translateY(-50%);
    z-index: 1000;
    background: var(--background-color);
    border: 1px solid var(--border-color);
    padding: 10px;
    cursor: pointer;
    border-radius: 4px 0 0 4px;
}

#three-d-viewer.collapsed {
    transform: translateX(100%);
}
```

### 3. JavaScript 구현

#### 3.1 스플릿바 드래그 기능
```javascript
// boq_detailed_estimation_handlers.js에 추가

function initBoqSplitBars() {
    const splitBars = document.querySelectorAll('.boq-split-bar');

    splitBars.forEach(bar => {
        let isResizing = false;
        let startX = 0;
        let startWidth = 0;
        let targetPanel = null;

        bar.addEventListener('mousedown', (e) => {
            isResizing = true;
            startX = e.clientX;

            const target = bar.dataset.target;
            if (target === 'left') {
                targetPanel = document.querySelector('.boq-left-panel');
            } else {
                targetPanel = document.querySelector('.boq-bim-object-summary-panel');
            }

            startWidth = targetPanel.offsetWidth;
            document.body.style.cursor = 'col-resize';
            e.preventDefault();
        });

        document.addEventListener('mousemove', (e) => {
            if (!isResizing) return;

            const deltaX = e.clientX - startX;
            const target = bar.dataset.target;

            if (target === 'left') {
                const newWidth = startWidth + deltaX;
                const minWidth = 250;
                const maxWidth = 600;
                targetPanel.style.width = `${Math.max(minWidth, Math.min(maxWidth, newWidth))}px`;
            } else {
                const newWidth = startWidth - deltaX;
                const minWidth = 250;
                const maxWidth = 600;
                targetPanel.style.width = `${Math.max(minWidth, Math.min(maxWidth, newWidth))}px`;
            }
        });

        document.addEventListener('mouseup', () => {
            if (isResizing) {
                isResizing = false;
                document.body.style.cursor = '';
            }
        });
    });
}
```

#### 3.2 우측 패널 토글
```javascript
function initBoqRightPanelToggle() {
    const toggleBtn = document.getElementById('boq-right-panel-toggle-btn');
    const container = document.querySelector('.boq-container');

    if (!toggleBtn) return;

    toggleBtn.addEventListener('click', () => {
        container.classList.toggle('right-panel-collapsed');
        console.log('[DEBUG] Right panel toggled');
    });
}
```

#### 3.3 3D 뷰포트 토글
```javascript
// navigation.js 또는 three_d_viewer.js에 추가

function initViewerToggle() {
    const toggleBtn = document.getElementById('viewer-toggle-btn');
    const viewer = document.getElementById('three-d-viewer');

    if (!toggleBtn) return;

    toggleBtn.addEventListener('click', () => {
        viewer.classList.toggle('collapsed');
        toggleBtn.textContent = viewer.classList.contains('collapsed')
            ? '▶ 보이기'
            : '◀ 숨기기';
    });
}
```

### 4. 호출 위치

#### app.js에서 초기화
```javascript
// setupDetailedEstimationListeners() 함수 내부에 추가
initBoqSplitBars();
initBoqRightPanelToggle();
```

## 주의사항

1. 기존 좌측 패널 토글 기능은 유지
2. 스플릿바 드래그 중 텍스트 선택 방지 (`user-select: none`)
3. 리사이즈 시 최소/최대 폭 제한 적용
4. 애니메이션은 부드럽게 (transition)
5. 저장된 폭 설정을 localStorage에 저장 (선택사항)

## 예상 파일 변경 목록

1. `/connections/templates/revit_control.html` - HTML 구조 수정
2. `/connections/static/connections/style.css` - 스타일 추가
3. `/connections/static/connections/boq_detailed_estimation_handlers.js` - JS 로직 추가
4. `/connections/static/connections/navigation.js` - 3D 뷰포트 토글 (선택사항)
