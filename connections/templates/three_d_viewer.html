<div class="three-d-viewer-main-wrapper">
    <!-- ▼▼▼ 상단 영역 (3D 뷰포트 + 공정 컨트롤) ▼▼▼ -->
    <div id="viewer-top-section" style="display: flex; flex-direction: column; flex: 1; min-height: 300px;">
        <div class="three-d-viewer-top-section">
            <div class="three-d-viewer-container">
                <!-- 원래의 3D canvas (왼쪽 작업용 뷰포트로 이동됨) -->
                <canvas id="three-d-canvas"></canvas>
                <div id="schedule-status-display" style="position: absolute; top: 10px; right: 10px; background: rgba(0, 0, 0, 0.8); color: white; padding: 10px 15px; border-radius: 5px; font-size: 13px; font-weight: bold; z-index: 100; display: none; max-width: 350px; box-shadow: 0 2px 8px rgba(0,0,0,0.3);">
                    <div id="schedule-status-text"></div>
                </div>
                <!-- 스케치 분할 컨트롤 (상단 가로 배치) -->
                <div class="sketch-controls-top" id="sketch-controls-panel" style="display: none;">
                    <div class="sketch-step">
                        <span class="sketch-step-label">1. 작업면</span>
                        <button id="select-face-btn">면 선택</button>
                        <span id="selected-face-info" class="sketch-info"></span>
                    </div>
                    <div class="sketch-step-separator"></div>
                    <div class="sketch-step">
                        <span class="sketch-step-label">2. 스케치</span>
                        <button id="start-sketch-btn" disabled>시작</button>
                        <button id="clear-sketch-btn" disabled>지우기</button>
                        <button id="close-sketch-btn" disabled>닫기</button>
                    </div>
                    <div class="sketch-step-separator"></div>
                    <div class="sketch-step">
                        <span class="sketch-step-label">3. 분할</span>
                        <button id="apply-sketch-split-btn" disabled>적용</button>
                        <button id="cancel-sketch-btn">취소</button>
                    </div>
                </div>

                <!-- 왼쪽 세로 버튼 그룹 -->
                <div class="viewer-controls">
                    <button id="return-to-previous-tab-btn" style="display: none; background-color: #2196F3;">← 이전</button>

                    <!-- 데이터 관리 그룹 -->
                    <div class="button-group">
                        <button id="load-geometry-btn">불러오기</button>
                        <button id="clear-scene-btn">초기화</button>
                    </div>

                    <!-- 카메라 모드 그룹 -->
                    <div class="button-group camera-group">
                        <button id="perspective-mode-btn" class="active">투시</button>
                        <button id="orthographic-mode-btn">직교</button>
                    </div>

                    <!-- 분할 관리 그룹 -->
                    <div class="button-group split-group">
                        <button id="sketch-split-btn" disabled>요소분할</button>
                        <button id="delete-all-splits-btn">분할삭제</button>
                    </div>

                    <!-- 가시성 관리 그룹 -->
                    <div class="button-group">
                        <button id="isolate-selection-btn" disabled title="선택된 객체만 표시">선택만</button>
                        <button id="hide-selection-btn" disabled title="선택된 객체 숨기기">선택숨김</button>
                        <button id="show-all-btn" disabled title="모든 객체 표시">전체보기</button>
                    </div>
                </div>

                <!-- ▼▼▼ [추가] 렌더링 모드 버튼 그룹 (하단 배치) ▼▼▼ -->
                <div class="rendering-controls-bar">
                    <button id="realistic-mode-btn" class="rendering-mode-btn active" title="실제 색상">실제색상</button>
                    <button id="white-mode-btn" class="rendering-mode-btn" title="하얀색 모드">백색</button>
                    <button id="wireframe-mode-btn" class="rendering-mode-btn" title="와이어프레임">선</button>
                    <button id="material-mode-btn" class="rendering-mode-btn" title="재질별 색상">재질</button>
                    <button id="edges-mode-btn" class="rendering-mode-btn" title="테두리선">테두리</button>
                    <button id="sunlight-mode-btn" class="rendering-mode-btn" title="태양광 음영">태양광</button>
                    <button id="shadow-toggle-btn" class="rendering-mode-btn shadow-btn" title="그림자 on/off">그림자 OFF</button>
                    <div class="button-separator"></div>
                    <button id="toggle-clipping-btn" class="rendering-mode-btn" title="단면 자르기">단면 OFF</button>
                    <button id="clip-axis-x-btn" class="rendering-mode-btn" title="X축 단면">X</button>
                    <button id="clip-axis-y-btn" class="rendering-mode-btn" title="Y축 단면">Y</button>
                    <button id="clip-axis-z-btn" class="rendering-mode-btn" title="Z축 단면">Z</button>
                    <button id="clip-move-plus-btn" class="rendering-mode-btn" title="단면 이동 +">+</button>
                    <button id="clip-move-minus-btn" class="rendering-mode-btn" title="단면 이동 -">-</button>
                    <div class="button-separator"></div>
                    <button id="toggle-measurement-btn" class="rendering-mode-btn" title="치수 측정">측정 OFF</button>
                    <button id="clear-measurements-btn" class="rendering-mode-btn" title="측정 삭제">측정삭제</button>
                    <button id="toggle-unit-btn" class="rendering-mode-btn" title="단위 변경 (mm/m)">mm</button>
                </div>
                <!-- ▲▲▲ [추가] 여기까지 ▲▲▲ -->
                <canvas id="sketch-canvas" style="position: absolute; top: 0; left: 0; display: none; pointer-events: none;"></canvas>
                <div id="dimension-input-display" style="position: absolute; bottom: 20px; left: 20px; display: none; background: rgba(0, 0, 0, 0.8); color: #00ff00; padding: 10px 15px; border-radius: 5px; font-family: 'Courier New', monospace; font-size: 18px; font-weight: bold; pointer-events: none; z-index: 1000;">
                    <span id="dimension-input-text"></span>
                </div>
                <div id="snap-indicator-2d" style="position: absolute; display: none; pointer-events: none; z-index: 1001;">
                    <div id="snap-icon" style="width: 20px; height: 20px; position: relative;"></div>
                    <div id="snap-label" style="margin-top: 2px; font-size: 11px; font-weight: bold; color: white; text-shadow: 1px 1px 2px black; white-space: nowrap; text-align: center;"></div>
                </div>
            </div>
            <div class="three-d-properties-panel">
                <div class="properties-header">
                    <div class="properties-tabs">
                        <button class="properties-tab-button active" data-tab="bim-properties">BIM 속성</button>
                        <button class="properties-tab-button" data-tab="quantity-members">수량산출부재</button>
                        <button class="properties-tab-button" data-tab="cost-items">산출항목</button>
                        <button class="properties-tab-button" data-tab="activities">액티비티</button>
                    </div>
                </div>
                <div class="properties-tab-content active" id="bim-properties-tab">
                    <div class="properties-content" id="three-d-properties-content">
                        <p class="no-selection">Click on an object to view its properties</p>
                    </div>
                </div>
                <div class="properties-tab-content" id="quantity-members-tab">
                    <div class="quantity-members-list-container">
                        <h4>연관된 수량산출부재</h4>
                        <div class="quantity-members-list" id="three-d-quantity-members-list">
                            <p class="no-selection">객체를 선택하세요</p>
                        </div>
                    </div>
                    <div class="quantity-member-details-container">
                        <h4>수량산출부재 속성</h4>
                        <div class="quantity-member-details" id="three-d-quantity-member-details">
                            <p class="no-selection">리스트에서 수량산출부재를 선택하세요</p>
                        </div>
                    </div>
                </div>
                <div class="properties-tab-content" id="cost-items-tab">
                    <div class="quantity-members-list-container">
                        <h4>연관된 산출항목</h4>
                        <div class="quantity-members-list" id="three-d-cost-items-list">
                            <p class="no-selection">객체를 선택하세요</p>
                        </div>
                    </div>
                    <div class="quantity-member-details-container">
                        <h4>산출항목 속성</h4>
                        <div class="quantity-member-details" id="three-d-cost-item-details">
                            <p class="no-selection">리스트에서 산출항목을 선택하세요</p>
                        </div>
                    </div>
                </div>
                <div class="properties-tab-content" id="activities-tab">
                    <div class="quantity-members-list-container">
                        <h4>연관된 액티비티</h4>
                        <div class="quantity-members-list" id="three-d-activities-list">
                            <p class="no-selection">객체를 선택하세요</p>
                        </div>
                    </div>
                    <div class="quantity-member-details-container">
                        <h4>액티비티 속성</h4>
                        <div class="quantity-member-details" id="three-d-activity-details">
                            <p class="no-selection">리스트에서 액티비티를 선택하세요</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <div id="viewer-schedule-controls" style="padding: 10px; background: #fafafa; border-top: 1px solid #ddd; border-bottom: 1px solid #ddd; flex: 0 0 auto;">
            <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                <!-- 날짜 선택 -->
                <div style="display: flex; align-items: center; gap: 10px; padding: 8px 12px; background: white; border-radius: 4px; border: 1px solid #ddd;">
                    <label for="viewer-cutoff-date" style="font-weight: bold;">공정 기준일:</label>
                    <input type="date" id="viewer-cutoff-date" style="padding: 5px; border: 1px solid #ddd; border-radius: 4px;">
                    <button id="apply-viewer-date-btn" style="padding: 5px 15px; background: #1976d2; color: white; border: none; border-radius: 4px; cursor: pointer;">적용</button>
                    <button id="reset-viewer-date-btn" style="padding: 5px 15px; background: #757575; color: white; border: none; border-radius: 4px; cursor: pointer;">전체 보기</button>
                </div>
            </div>
        </div>
    </div>
    <!-- ▲▲▲ 상단 영역 끝 ▲▲▲ -->

    <!-- ▼▼▼ 중간 영역 (공사코드별 비용 정보 / 공정표) ▼▼▼ -->
    <div id="viewer-middle-section" class="three-d-viewer-bottom-section" style="flex: 1 1 250px; min-height: 150px;">
        <div style="display: flex; border-bottom: 2px solid #ddd; margin-bottom: 10px;">
            <button class="viewer-bottom-tab-btn active" data-tab="cost-items" style="padding: 10px 20px; border: none; background: #1976d2; color: white; cursor: pointer; font-size: 13px; font-weight: bold; border-radius: 4px 4px 0 0; margin-right: 2px;">
                공사코드별 비용 정보
            </button>
            <button class="viewer-bottom-tab-btn" data-tab="gantt-chart" style="padding: 10px 20px; border: none; background: #f5f5f5; color: #666; cursor: pointer; font-size: 13px; border-radius: 4px 4px 0 0;">
                공정표
            </button>
        </div>

        <!-- Cost Items Tab -->
        <div class="viewer-bottom-tab-content active" data-tab="cost-items">
            <div class="cost-items-panel">
                <div class="cost-items-panel-content" id="three-d-cost-items-table">
                    <p class="no-selection">객체를 선택하세요</p>
                </div>
            </div>
        </div>

        <!-- Gantt Chart Tab -->
        <div class="viewer-bottom-tab-content" data-tab="gantt-chart" style="display: none; height: 100%; overflow: auto; flex-direction: column;">
            <!-- ▼▼▼ [추가] 시뮬레이션 컨트롤 ▼▼▼ -->
            <div id="simulation-controls-panel" style="padding: 10px; background: #fafafa; border-bottom: 2px solid #ddd; flex: 0 0 auto;">
                <div style="display: flex; align-items: center; gap: 15px; flex-wrap: wrap;">
                    <!-- 날짜 선택 -->
                    <div style="display: flex; align-items: center; gap: 10px; padding: 8px 12px; background: white; border-radius: 4px; border: 1px solid #ddd;">
                        <label for="sim-cutoff-date" style="font-weight: bold;">공정 기준일:</label>
                        <input type="date" id="sim-cutoff-date" style="padding: 5px; border: 1px solid #ddd; border-radius: 4px;">
                        <button id="apply-sim-date-btn" style="padding: 5px 15px; background: #1976d2; color: white; border: none; border-radius: 4px; cursor: pointer;">적용</button>
                        <button id="reset-sim-date-btn" style="padding: 5px 15px; background: #757575; color: white; border: none; border-radius: 4px; cursor: pointer;">초기화</button>
                    </div>

                    <!-- 시뮬레이션 컨트롤 -->
                    <div style="display: flex; align-items: center; gap: 10px; padding: 8px 12px; background: #e3f2fd; border-radius: 4px; border: 1px solid #1976d2;">
                        <label style="font-weight: bold; color: #1976d2;">시뮬레이션:</label>
                        <button id="sim-play-btn" style="padding: 5px 15px; background: #4caf50; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;">▶ 재생</button>
                        <button id="sim-pause-btn" style="padding: 5px 15px; background: #ff9800; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;" disabled>⏸ 일시정지</button>
                        <button id="sim-stop-btn" style="padding: 5px 15px; background: #f44336; color: white; border: none; border-radius: 4px; cursor: pointer; font-weight: bold;" disabled>⏹ 정지</button>
                        <label for="sim-speed" style="margin-left: 5px;">속도:</label>
                        <select id="sim-speed" style="padding: 5px; border: 1px solid #1976d2; border-radius: 4px;">
                            <option value="0.5">0.5x</option>
                            <option value="1" selected>1x</option>
                            <option value="2">2x</option>
                            <option value="5">5x</option>
                            <option value="10">10x</option>
                        </select>
                        <label for="sim-interval">간격:</label>
                        <select id="sim-interval" style="padding: 5px; border: 1px solid #1976d2; border-radius: 4px;">
                            <option value="1" selected>1일</option>
                            <option value="7">7일</option>
                            <option value="30">30일</option>
                        </select>
                        <span id="sim-current-date" style="margin-left: 10px; font-weight: bold; color: #1976d2; min-width: 100px;"></span>
                    </div>
                </div>
            </div>
            <!-- ▲▲▲ [추가] 여기까지 ▲▲▲ -->
            <div id="viewer-gantt-chart-container" style="flex: 1; overflow: auto;">
                <p style="padding: 20px; text-align: center; color: #999;">간트차트 탭의 데이터를 로드해주세요</p>
            </div>
        </div>
    </div>
    <!-- ▲▲▲ 중간 영역 끝 ▲▲▲ -->

    <!-- ▼▼▼ 두 번째 스플릿바 (공사코드별 비용정보 ↔ 내역집계표) ▼▼▼ -->
    <div id="viewer-resize-handle-bottom" style="height: 8px; background: #ddd; cursor: ns-resize; display: flex; align-items: center; justify-content: center; border-top: 1px solid #bbb; border-bottom: 1px solid #bbb; flex: 0 0 8px;">
        <div style="width: 60px; height: 4px; background: #999; border-radius: 2px;"></div>
    </div>
    <!-- ▲▲▲ 두 번째 스플릿바 끝 ▲▲▲ -->

    <!-- ▼▼▼ 하단 영역 (내역집계표) ▼▼▼ -->
    <div id="viewer-boq-section" class="viewer-boq-section" style="border-top: 2px solid #ddd; background: #fafafa; flex: 0 0 50px; display: flex; flex-direction: column; min-height: 50px;">
        <div id="viewer-boq-toggle-header" style="padding: 12px 20px; cursor: pointer; display: flex; justify-content: space-between; align-items: center; background: #e3f2fd; border-bottom: 1px solid #1976d2; flex-shrink: 0;">
            <h3 style="margin: 0; color: #1976d2; font-size: 15px; font-weight: bold;">📊 내역집계표 (날짜 기준)</h3>
            <span id="viewer-boq-toggle-icon" style="font-size: 18px; color: #1976d2; font-weight: bold;">▼</span>
        </div>
        <div id="viewer-boq-content" class="viewer-boq-content" style="display: none; background: white; flex: 1; overflow-y: auto; min-height: 0;">
            <div style="padding: 15px;">
                <p style="text-align: center; color: #999;">공정 기준일을 선택하면 해당 일자까지의 내역집계표가 표시됩니다.</p>
            </div>
        </div>
    </div>
    <!-- ▲▲▲ 하단 영역 끝 ▲▲▲ -->
</div>
